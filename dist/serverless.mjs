var xo=Object.create;var Je=Object.defineProperty;var Eo=Object.getOwnPropertyDescriptor;var bo=Object.getOwnPropertyNames;var vo=Object.getPrototypeOf,Ao=Object.prototype.hasOwnProperty;var _o=(r,e,t)=>e in r?Je(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ee=(r,e)=>()=>(r&&(e=r(r=0)),e);var C=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),le=(r,e)=>{for(var t in e)Je(r,t,{get:e[t],enumerable:!0})},Tn=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of bo(e))!Ao.call(r,i)&&i!==t&&Je(r,i,{get:()=>e[i],enumerable:!(n=Eo(e,i))||n.enumerable});return r};var zt=(r,e,t)=>(t=r!=null?xo(vo(r)):{},Tn(e||!r||!r.__esModule?Je(t,"default",{value:r,enumerable:!0}):t,r)),K=r=>Tn(Je({},"__esModule",{value:!0}),r);var we=(r,e,t)=>(_o(r,typeof e!="symbol"?e+"":e,t),t);var kn=C(mt=>{"use strict";d();mt.byteLength=Uo;mt.toByteArray=Lo;mt.fromByteArray=Po;var me=[],fe=[],Co=typeof Uint8Array<"u"?Uint8Array:Array,Yt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Le=0,Pn=Yt.length;Le<Pn;++Le)me[Le]=Yt[Le],fe[Yt.charCodeAt(Le)]=Le;var Le,Pn;fe["-".charCodeAt(0)]=62;fe["_".charCodeAt(0)]=63;function Rn(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Uo(r){var e=Rn(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Io(r,e,t){return(e+t)*3/4-t}function Lo(r){var e,t=Rn(r),n=t[0],i=t[1],s=new Co(Io(r,n,i)),o=0,a=i>0?n-4:n,u;for(u=0;u<a;u+=4)e=fe[r.charCodeAt(u)]<<18|fe[r.charCodeAt(u+1)]<<12|fe[r.charCodeAt(u+2)]<<6|fe[r.charCodeAt(u+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=fe[r.charCodeAt(u)]<<2|fe[r.charCodeAt(u+1)]>>4,s[o++]=e&255),i===1&&(e=fe[r.charCodeAt(u)]<<10|fe[r.charCodeAt(u+1)]<<4|fe[r.charCodeAt(u+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Bo(r){return me[r>>18&63]+me[r>>12&63]+me[r>>6&63]+me[r&63]}function To(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(Bo(n));return i.join("")}function Po(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(To(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(me[e>>2]+me[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(me[e>>10]+me[e>>4&63]+me[e<<2&63]+"=")),i.join("")}});var Mn=C(Jt=>{d();Jt.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,u=(1<<a)-1,c=u>>1,h=-7,l=t?i-1:0,y=t?-1:1,m=r[e+l];for(l+=y,s=m&(1<<-h)-1,m>>=-h,h+=a;h>0;s=s*256+r[e+l],l+=y,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+r[e+l],l+=y,h-=8);if(s===0)s=1-c;else{if(s===u)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-c}return(m?-1:1)*o*Math.pow(2,s-n)};Jt.write=function(r,e,t,n,i,s){var o,a,u,c=s*8-i-1,h=(1<<c)-1,l=h>>1,y=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:s-1,S=n?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+l>=1?e+=y/u:e+=y*Math.pow(2,1-l),e*u>=2&&(o++,u/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(e*u-1)*Math.pow(2,i),o=o+l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;r[t+m]=a&255,m+=S,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;r[t+m]=o&255,m+=S,o/=256,c-=8);r[t+m-S]|=U*128}});var Zn=C(Ne=>{"use strict";d();var Zt=kn(),ke=Mn(),Nn=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Ne.Buffer=f;Ne.SlowBuffer=Do;Ne.INSPECT_MAX_BYTES=50;var gt=2147483647;Ne.kMaxLength=gt;f.TYPED_ARRAY_SUPPORT=Ro();!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Ro(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(!!f.isBuffer(this))return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(!!f.isBuffer(this))return this.byteOffset}});function xe(r){if(r>gt)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,f.prototype),e}function f(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return rr(r)}return On(r,e,t)}f.poolSize=8192;function On(r,e,t){if(typeof r=="string")return Mo(r,e);if(ArrayBuffer.isView(r))return No(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(ge(r,ArrayBuffer)||r&&ge(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ge(r,SharedArrayBuffer)||r&&ge(r.buffer,SharedArrayBuffer)))return er(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return f.from(n,e,t);let i=Fo(r);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return f.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}f.from=function(r,e,t){return On(r,e,t)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function Qn(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function ko(r,e,t){return Qn(r),r<=0?xe(r):e!==void 0?typeof t=="string"?xe(r).fill(e,t):xe(r).fill(e):xe(r)}f.alloc=function(r,e,t){return ko(r,e,t)};function rr(r){return Qn(r),xe(r<0?0:nr(r)|0)}f.allocUnsafe=function(r){return rr(r)};f.allocUnsafeSlow=function(r){return rr(r)};function Mo(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=Hn(r,e)|0,n=xe(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function Xt(r){let e=r.length<0?0:nr(r.length)|0,t=xe(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function No(r){if(ge(r,Uint8Array)){let e=new Uint8Array(r);return er(e.buffer,e.byteOffset,e.byteLength)}return Xt(r)}function er(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,f.prototype),n}function Fo(r){if(f.isBuffer(r)){let e=nr(r.length)|0,t=xe(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||sr(r.length)?xe(0):Xt(r);if(r.type==="Buffer"&&Array.isArray(r.data))return Xt(r.data)}function nr(r){if(r>=gt)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+gt.toString(16)+" bytes");return r|0}function Do(r){return+r!=r&&(r=0),f.alloc(+r)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype};f.compare=function(e,t){if(ge(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),ge(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=f.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(ge(o,Uint8Array))s+o.length>i.length?(f.isBuffer(o)||(o=f.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(f.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function Hn(r,e){if(f.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||ge(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return tr(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return Jn(r).length;default:if(i)return n?-1:tr(r).length;e=(""+e).toLowerCase(),i=!0}}f.byteLength=Hn;function qo(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return zo(this,e,t);case"utf8":case"utf-8":return $n(this,e,t);case"ascii":return Go(this,e,t);case"latin1":case"binary":return Vo(this,e,t);case"base64":return Ko(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yo(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}f.prototype._isBuffer=!0;function Be(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}f.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)Be(this,t,t+1);return this};f.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)Be(this,t,t+3),Be(this,t+1,t+2);return this};f.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)Be(this,t,t+7),Be(this,t+1,t+6),Be(this,t+2,t+5),Be(this,t+3,t+4);return this};f.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?$n(this,0,e):qo.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:f.compare(this,e)===0};f.prototype.inspect=function(){let e="",t=Ne.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};Nn&&(f.prototype[Nn]=f.prototype.inspect);f.prototype.compare=function(e,t,n,i,s){if(ge(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,u=Math.min(o,a),c=this.slice(i,s),h=e.slice(t,n);for(let l=0;l<u;++l)if(c[l]!==h[l]){o=c[l],a=h[l];break}return o<a?-1:a<o?1:0};function jn(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,sr(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=f.from(e,n)),f.isBuffer(e))return e.length===0?-1:Fn(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):Fn(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function Fn(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function u(h,l){return s===1?h[l]:h.readUInt16BE(l*s)}let c;if(i){let h=-1;for(c=t;c<o;c++)if(u(r,c)===u(e,h===-1?0:c-h)){if(h===-1&&(h=c),c-h+1===a)return h*s}else h!==-1&&(c-=c-h),h=-1}else for(t+a>o&&(t=o-a),c=t;c>=0;c--){let h=!0;for(let l=0;l<a;l++)if(u(r,c+l)!==u(e,l)){h=!1;break}if(h)return c}return-1}f.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};f.prototype.indexOf=function(e,t,n){return jn(this,e,t,n,!0)};f.prototype.lastIndexOf=function(e,t,n){return jn(this,e,t,n,!1)};function Oo(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(sr(a))return o;r[t+o]=a}return o}function Qo(r,e,t,n){return St(tr(e,r.length-t),r,t,n)}function Ho(r,e,t,n){return St(ea(e),r,t,n)}function jo(r,e,t,n){return St(Jn(e),r,t,n)}function $o(r,e,t,n){return St(ta(e,r.length-t),r,t,n)}f.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return Oo(this,e,t,n);case"utf8":case"utf-8":return Qo(this,e,t,n);case"ascii":case"latin1":case"binary":return Ho(this,e,t,n);case"base64":return jo(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $o(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ko(r,e,t){return e===0&&t===r.length?Zt.fromByteArray(r):Zt.fromByteArray(r.slice(e,t))}function $n(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let u,c,h,l;switch(a){case 1:s<128&&(o=s);break;case 2:u=r[i+1],(u&192)===128&&(l=(s&31)<<6|u&63,l>127&&(o=l));break;case 3:u=r[i+1],c=r[i+2],(u&192)===128&&(c&192)===128&&(l=(s&15)<<12|(u&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:u=r[i+1],c=r[i+2],h=r[i+3],(u&192)===128&&(c&192)===128&&(h&192)===128&&(l=(s&15)<<18|(u&63)<<12|(c&63)<<6|h&63,l>65535&&l<1114112&&(o=l))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return Wo(n)}var Dn=4096;function Wo(r){let e=r.length;if(e<=Dn)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=Dn));return t}function Go(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function Vo(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function zo(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=ra[r[s]];return i}function Yo(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}f.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,f.prototype),i};function W(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||W(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||W(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e=e>>>0,t||W(e,1,this.length),this[e]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||W(e,2,this.length),this[e]|this[e+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||W(e,2,this.length),this[e]<<8|this[e+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||W(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||W(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};f.prototype.readBigUInt64LE=ve(function(e){e=e>>>0,Me(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ze(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});f.prototype.readBigUInt64BE=ve(function(e){e=e>>>0,Me(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ze(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});f.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||W(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};f.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||W(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};f.prototype.readInt8=function(e,t){return e=e>>>0,t||W(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};f.prototype.readInt16LE=function(e,t){e=e>>>0,t||W(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};f.prototype.readInt16BE=function(e,t){e=e>>>0,t||W(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};f.prototype.readInt32LE=function(e,t){return e=e>>>0,t||W(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};f.prototype.readInt32BE=function(e,t){return e=e>>>0,t||W(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};f.prototype.readBigInt64LE=ve(function(e){e=e>>>0,Me(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ze(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});f.prototype.readBigInt64BE=ve(function(e){e=e>>>0,Me(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ze(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});f.prototype.readFloatLE=function(e,t){return e=e>>>0,t||W(e,4,this.length),ke.read(this,e,!0,23,4)};f.prototype.readFloatBE=function(e,t){return e=e>>>0,t||W(e,4,this.length),ke.read(this,e,!1,23,4)};f.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||W(e,8,this.length),ke.read(this,e,!0,52,8)};f.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||W(e,8,this.length),ke.read(this,e,!1,52,8)};function oe(r,e,t,n,i,s){if(!f.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;oe(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;oe(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,1,255,0),this[t]=e&255,t+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Kn(r,e,t,n,i){Yn(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function Wn(r,e,t,n,i){Yn(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}f.prototype.writeBigUInt64LE=ve(function(e,t=0){return Kn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeBigUInt64BE=ve(function(e,t=0){return Wn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let u=Math.pow(2,8*n-1);oe(this,e,t,n,u-1,-u)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};f.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let u=Math.pow(2,8*n-1);oe(this,e,t,n,u-1,-u)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};f.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};f.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};f.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||oe(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};f.prototype.writeBigInt64LE=ve(function(e,t=0){return Kn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});f.prototype.writeBigInt64BE=ve(function(e,t=0){return Wn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Gn(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Vn(r,e,t,n,i){return e=+e,t=t>>>0,i||Gn(r,e,t,4,34028234663852886e22,-34028234663852886e22),ke.write(r,e,t,n,23,4),t+4}f.prototype.writeFloatLE=function(e,t,n){return Vn(this,e,t,!0,n)};f.prototype.writeFloatBE=function(e,t,n){return Vn(this,e,t,!1,n)};function zn(r,e,t,n,i){return e=+e,t=t>>>0,i||Gn(r,e,t,8,17976931348623157e292,-17976931348623157e292),ke.write(r,e,t,n,52,8),t+8}f.prototype.writeDoubleLE=function(e,t,n){return zn(this,e,t,!0,n)};f.prototype.writeDoubleBE=function(e,t,n){return zn(this,e,t,!1,n)};f.prototype.copy=function(e,t,n,i){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};f.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!f.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=f.isBuffer(e)?e:f.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var Re={};function ir(r,e,t){Re[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}ir("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);ir("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);ir("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=qn(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=qn(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function qn(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function Jo(r,e,t){Me(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&Ze(e,r.length-(t+1))}function Yn(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new Re.ERR_OUT_OF_RANGE("value",a,r)}Jo(n,i,s)}function Me(r,e){if(typeof r!="number")throw new Re.ERR_INVALID_ARG_TYPE(e,"number",r)}function Ze(r,e,t){throw Math.floor(r)!==r?(Me(r,t),new Re.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Re.ERR_BUFFER_OUT_OF_BOUNDS:new Re.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var Zo=/[^+/0-9A-Za-z-_]/g;function Xo(r){if(r=r.split("=")[0],r=r.trim().replace(Zo,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function tr(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function ea(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function ta(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function Jn(r){return Zt.toByteArray(Xo(r))}function St(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function ge(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function sr(r){return r!==r}var ra=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function ve(r){return typeof BigInt>"u"?na:r}function na(){throw new Error("BigInt not supported")}});var x,b,v,g,p,w,d=ee(()=>{"use strict";x=globalThis,b=globalThis.setImmediate??(r=>setTimeout(r,0)),v=globalThis.clearImmediate??(r=>clearTimeout(r)),g=globalThis.crypto??{};g.subtle??={};p=typeof globalThis.Buffer=="function"&&typeof globalThis.Buffer.allocUnsafe=="function"?globalThis.Buffer:Zn().Buffer,w=globalThis.process??{};w.env??={};try{w.nextTick(()=>{})}catch{let e=Promise.resolve();w.nextTick=e.then.bind(e)}});var Xn={};le(Xn,{parse:()=>or});function or(r,e=!1){let{protocol:t}=new URL(r),n="http:"+r.substring(t.length),{username:i,password:s,hostname:o,port:a,pathname:u,search:c,searchParams:h,hash:l}=new URL(n);s=decodeURIComponent(s);let y=i+":"+s,m=e?Object.fromEntries(h.entries()):c;return{href:r,protocol:t,auth:y,username:i,password:s,hostname:o,port:a,pathname:u,search:c,query:m,hash:l}}var ar=ee(()=>{"use strict";d()});var Ae=C((Kh,ur)=>{"use strict";d();var Fe=typeof Reflect=="object"?Reflect:null,ei=Fe&&typeof Fe.apply=="function"?Fe.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Et;Fe&&typeof Fe.ownKeys=="function"?Et=Fe.ownKeys:Object.getOwnPropertySymbols?Et=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Et=function(e){return Object.getOwnPropertyNames(e)};function ia(r){console&&console.warn&&console.warn(r)}var ri=Number.isNaN||function(e){return e!==e};function k(){k.init.call(this)}ur.exports=k;ur.exports.once=ua;k.EventEmitter=k;k.prototype._events=void 0;k.prototype._eventsCount=0;k.prototype._maxListeners=void 0;var ti=10;function bt(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(k,"defaultMaxListeners",{enumerable:!0,get:function(){return ti},set:function(r){if(typeof r!="number"||r<0||ri(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");ti=r}});k.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};k.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ri(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ni(r){return r._maxListeners===void 0?k.defaultMaxListeners:r._maxListeners}k.prototype.getMaxListeners=function(){return ni(this)};k.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")ei(u,this,t);else for(var c=u.length,h=ui(u,c),n=0;n<c;++n)ei(h[n],this,t);return!0};function ii(r,e,t,n){var i,s,o;if(bt(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=ni(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,ia(a)}return r}k.prototype.addListener=function(e,t){return ii(this,e,t,!1)};k.prototype.on=k.prototype.addListener;k.prototype.prependListener=function(e,t){return ii(this,e,t,!0)};function sa(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function si(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=sa.bind(n);return i.listener=t,n.wrapFn=i,i}k.prototype.once=function(e,t){return bt(t),this.on(e,si(this,e,t)),this};k.prototype.prependOnceListener=function(e,t){return bt(t),this.prependListener(e,si(this,e,t)),this};k.prototype.removeListener=function(e,t){var n,i,s,o,a;if(bt(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():oa(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};k.prototype.off=k.prototype.removeListener;k.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function oi(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?aa(i):ui(i,i.length)}k.prototype.listeners=function(e){return oi(this,e,!0)};k.prototype.rawListeners=function(e){return oi(this,e,!1)};k.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):ai.call(r,e)};k.prototype.listenerCount=ai;function ai(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}k.prototype.eventNames=function(){return this._eventsCount>0?Et(this._events):[]};function ui(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function oa(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function aa(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function ua(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}ci(r,e,s,{once:!0}),e!=="error"&&ca(r,i,{once:!0})})}function ca(r,e,t){typeof r.on=="function"&&ci(r,"error",e,t)}function ci(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});function Xe(r){let e=1779033703,t=3144134277,n=1013904242,i=2773480762,s=1359893119,o=2600822924,a=528734635,u=1541459225,c=0,h=0,l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],y=(_,E)=>_>>>E|_<<32-E,m=new Uint32Array(64),S=new Uint8Array(64),U=()=>{for(let L=0,R=0;L<16;L++,R+=4)m[L]=S[R]<<24|S[R+1]<<16|S[R+2]<<8|S[R+3];for(let L=16;L<64;L++){let R=y(m[L-15],7)^y(m[L-15],18)^m[L-15]>>>3,N=y(m[L-2],17)^y(m[L-2],19)^m[L-2]>>>10;m[L]=m[L-16]+R+m[L-7]+N|0}let _=e,E=t,j=n,z=i,P=s,J=o,$=a,he=u;for(let L=0;L<64;L++){let R=y(P,6)^y(P,11)^y(P,25),N=P&J^~P&$,O=he+R+N+l[L]+m[L]|0,Q=y(_,2)^y(_,13)^y(_,22),Z=_&E^_&j^E&j,X=Q+Z|0;he=$,$=J,J=P,P=z+O|0,z=j,j=E,E=_,_=O+X|0}e=e+_|0,t=t+E|0,n=n+j|0,i=i+z|0,s=s+P|0,o=o+J|0,a=a+$|0,u=u+he|0,h=0},I=_=>{typeof _=="string"&&(_=new TextEncoder().encode(_));for(let E=0;E<_.length;E++)S[h++]=_[E],h===64&&U();c+=_.length},M=()=>{if(S[h++]=128,h==64&&U(),h+8>64){for(;h<64;)S[h++]=0;U()}for(;h<58;)S[h++]=0;let _=c*8;S[h++]=_/1099511627776&255,S[h++]=_/4294967296&255,S[h++]=_>>>24,S[h++]=_>>>16&255,S[h++]=_>>>8&255,S[h++]=_&255,U();let E=new Uint8Array(32);return E[0]=e>>>24,E[1]=e>>>16&255,E[2]=e>>>8&255,E[3]=e&255,E[4]=t>>>24,E[5]=t>>>16&255,E[6]=t>>>8&255,E[7]=t&255,E[8]=n>>>24,E[9]=n>>>16&255,E[10]=n>>>8&255,E[11]=n&255,E[12]=i>>>24,E[13]=i>>>16&255,E[14]=i>>>8&255,E[15]=i&255,E[16]=s>>>24,E[17]=s>>>16&255,E[18]=s>>>8&255,E[19]=s&255,E[20]=o>>>24,E[21]=o>>>16&255,E[22]=o>>>8&255,E[23]=o&255,E[24]=a>>>24,E[25]=a>>>16&255,E[26]=a>>>8&255,E[27]=a&255,E[28]=u>>>24,E[29]=u>>>16&255,E[30]=u>>>8&255,E[31]=u&255,E};return r===void 0?{add:I,digest:M}:(I(r),M())}var hi=ee(()=>{"use strict";d()});var cr={};le(cr,{createHash:()=>la,createHmac:()=>fa,randomBytes:()=>ha});function ha(r){return g.getRandomValues(p.alloc(r))}function la(r){if(r!=="sha256")throw new Error("Only sha256 is supported");return{update:function(e){return{digest:function(){return p.from(Xe(e))}}}}}function fa(r,e){if(r!=="sha256")throw new Error("Only sha256 is supported");return{update:function(t){return{digest:function(){typeof e=="string"&&(e=new TextEncoder().encode(e)),typeof t=="string"&&(t=new TextEncoder().encode(t));let n=e.length;if(n>64)e=Xe(e);else if(n<64){let u=new Uint8Array(64);u.set(e),e=u}let i=new Uint8Array(64),s=new Uint8Array(64);for(let u=0;u<64;u++)i[u]=54^e[u],s[u]=92^e[u];let o=new Uint8Array(t.length+64);o.set(i,0),o.set(t,64);let a=new Uint8Array(64+32);return a.set(s,0),a.set(Xe(o),64),p.from(Xe(a))}}}}}var hr=ee(()=>{d();hi()});var lr=C(li=>{"use strict";d();li.parse=function(r,e){return new et(r,e).parse()};var et=class{constructor(e,t){this.source=e,this.transform=t||da,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,n,i;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!i)this.dimension++,this.dimension>1&&(n=new et(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(t.value==="}"&&!i){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(i&&this.newEntry(!0),i=!i):t.value===","&&!i?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function da(r){return r}});var fr=C((Xh,fi)=>{d();var pa=lr();fi.exports={create:function(r,e){return{parse:function(){return pa.parse(r,e)}}}}});var yi=C((tl,pi)=>{"use strict";d();var ya=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,wa=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,ma=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,ga=/^-?infinity$/;pi.exports=function(e){if(ga.test(e))return Number(e.replace("i","I"));var t=ya.exec(e);if(!t)return Sa(e)||null;var n=!!t[8],i=parseInt(t[1],10);n&&(i=di(i));var s=parseInt(t[2],10)-1,o=t[3],a=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),h=t[7];h=h?1e3*parseFloat(h):0;var l,y=xa(e);return y!=null?(l=new Date(Date.UTC(i,s,o,a,u,c,h)),dr(i)&&l.setUTCFullYear(i),y!==0&&l.setTime(l.getTime()-y)):(l=new Date(i,s,o,a,u,c,h),dr(i)&&l.setFullYear(i)),l};function Sa(r){var e=wa.exec(r);if(!!e){var t=parseInt(e[1],10),n=!!e[4];n&&(t=di(t));var i=parseInt(e[2],10)-1,s=e[3],o=new Date(t,i,s);return dr(t)&&o.setFullYear(t),o}}function xa(r){if(r.endsWith("+00"))return 0;var e=ma.exec(r.split(" ")[1]);if(!!e){var t=e[1];if(t==="Z")return 0;var n=t==="-"?-1:1,i=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return i*n*1e3}}function di(r){return-(r-1)}function dr(r){return r>=0&&r<100}});var mi=C((nl,wi)=>{d();wi.exports=ba;var Ea=Object.prototype.hasOwnProperty;function ba(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Ea.call(t,n)&&(r[n]=t[n])}return r}});var xi=C((sl,Si)=>{"use strict";d();var va=mi();Si.exports=De;function De(r){if(!(this instanceof De))return new De(r);va(this,Ma(r))}var Aa=["seconds","minutes","hours","days","months","years"];De.prototype.toPostgres=function(){var r=Aa.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var _a={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Ca=["years","months","days"],Ua=["hours","minutes","seconds"];De.prototype.toISOString=De.prototype.toISO=function(){var r=Ca.map(t,this).join(""),e=Ua.map(t,this).join("");return"P"+r+"T"+e;function t(n){var i=this[n]||0;return n==="seconds"&&this.milliseconds&&(i=(i+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),i+_a[n]}};var pr="([+-]?\\d+)",Ia=pr+"\\s+years?",La=pr+"\\s+mons?",Ba=pr+"\\s+days?",Ta="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Pa=new RegExp([Ia,La,Ba,Ta].map(function(r){return"("+r+")?"}).join("\\s*")),gi={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Ra=["hours","minutes","seconds","milliseconds"];function ka(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function Ma(r){if(!r)return{};var e=Pa.exec(r),t=e[8]==="-";return Object.keys(gi).reduce(function(n,i){var s=gi[i],o=e[s];return!o||(o=i==="milliseconds"?ka(o):parseInt(o,10),!o)||(t&&~Ra.indexOf(i)&&(o*=-1),n[i]=o),n},{})}});var bi=C((al,Ei)=>{"use strict";d();Ei.exports=function(e){if(/^\\x/.test(e))return new p(e.substr(2),"hex");for(var t="",n=0;n<e.length;)if(e[n]!=="\\")t+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))t+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var i=1;n+i<e.length&&e[n+i]==="\\";)i++;for(var s=0;s<Math.floor(i/2);++s)t+="\\";n+=Math.floor(i/2)*2}return new p(t,"binary")}});var Li=C((cl,Ii)=>{d();var tt=lr(),rt=fr(),vt=yi(),Ai=xi(),_i=bi();function At(r){return function(t){return t===null?t:r(t)}}function Ci(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function Na(r){return r?tt.parse(r,Ci):null}function Fa(r){return parseInt(r,10)}function yr(r){return r?tt.parse(r,At(Fa)):null}function Da(r){return r?tt.parse(r,At(function(e){return Ui(e).trim()})):null}var qa=function(r){if(!r)return null;var e=rt.create(r,function(t){return t!==null&&(t=Sr(t)),t});return e.parse()},wr=function(r){if(!r)return null;var e=rt.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},de=function(r){if(!r)return null;var e=rt.create(r);return e.parse()},mr=function(r){if(!r)return null;var e=rt.create(r,function(t){return t!==null&&(t=vt(t)),t});return e.parse()},Oa=function(r){if(!r)return null;var e=rt.create(r,function(t){return t!==null&&(t=Ai(t)),t});return e.parse()},Qa=function(r){return r?tt.parse(r,At(_i)):null},gr=function(r){return parseInt(r,10)},Ui=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},vi=function(r){return r?tt.parse(r,At(JSON.parse)):null},Sr=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},Ha=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",n=!1,i=2;i<r.length-1;i++){if(n||(e+=r[i]),r[i]===")"){n=!0;continue}else if(!n)continue;r[i]!==","&&(t+=r[i])}var s=Sr(e);return s.radius=parseFloat(t),s},ja=function(r){r(20,Ui),r(21,gr),r(23,gr),r(26,gr),r(700,parseFloat),r(701,parseFloat),r(16,Ci),r(1082,vt),r(1114,vt),r(1184,vt),r(600,Sr),r(651,de),r(718,Ha),r(1e3,Na),r(1001,Qa),r(1005,yr),r(1007,yr),r(1028,yr),r(1016,Da),r(1017,qa),r(1021,wr),r(1022,wr),r(1231,wr),r(1014,de),r(1015,de),r(1008,de),r(1009,de),r(1040,de),r(1041,de),r(1115,mr),r(1182,mr),r(1185,mr),r(1186,Ai),r(1187,Oa),r(17,_i),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,vi),r(3807,vi),r(3907,de),r(2951,de),r(791,de),r(1183,de),r(1270,de)};Ii.exports={init:ja}});var Ti=C((ll,Bi)=>{"use strict";d();var ae=1e6;function $a(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),n="";e<0&&(e=~e+(t===0),t=~t+1>>>0,n="-");var i="",s,o,a,u,c,h;{if(s=e%ae,e=e/ae>>>0,o=4294967296*s+t,t=o/ae>>>0,a=""+(o-ae*t),t===0&&e===0)return n+a+i;for(u="",c=6-a.length,h=0;h<c;h++)u+="0";i=u+a+i}{if(s=e%ae,e=e/ae>>>0,o=4294967296*s+t,t=o/ae>>>0,a=""+(o-ae*t),t===0&&e===0)return n+a+i;for(u="",c=6-a.length,h=0;h<c;h++)u+="0";i=u+a+i}{if(s=e%ae,e=e/ae>>>0,o=4294967296*s+t,t=o/ae>>>0,a=""+(o-ae*t),t===0&&e===0)return n+a+i;for(u="",c=6-a.length,h=0;h<c;h++)u+="0";i=u+a+i}return s=e%ae,o=4294967296*s+t,a=""+o%ae,n+a+i}Bi.exports=$a});var Ni=C((dl,Mi)=>{d();var Ka=Ti(),D=function(r,e,t,n,i){t=t||0,n=n||!1,i=i||function(m,S,U){return m*Math.pow(2,U)+S};var s=t>>3,o=function(m){return n?~m&255:m},a=255,u=8-t%8;e<u&&(a=255<<8-e&255,u=e),t&&(a=a>>t%8);var c=0;t%8+e>=8&&(c=i(0,o(r[s])&a,u));for(var h=e+t>>3,l=s+1;l<h;l++)c=i(c,o(r[l]),8);var y=(e+t)%8;return y>0&&(c=i(c,o(r[h])>>8-y,y)),c},ki=function(r,e,t){var n=Math.pow(2,t-1)-1,i=D(r,1),s=D(r,t,1);if(s===0)return 0;var o=1,a=function(c,h,l){c===0&&(c=1);for(var y=1;y<=l;y++)o/=2,(h&1<<l-y)>0&&(c+=o);return c},u=D(r,e,t+1,!1,a);return s==Math.pow(2,t+1)-1?u===0?i===0?1/0:-1/0:NaN:(i===0?1:-1)*Math.pow(2,s-n)*u},Wa=function(r){return D(r,1)==1?-1*(D(r,15,1,!0)+1):D(r,15,1)},Pi=function(r){return D(r,1)==1?-1*(D(r,31,1,!0)+1):D(r,31,1)},Ga=function(r){return ki(r,23,8)},Va=function(r){return ki(r,52,11)},za=function(r){var e=D(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,D(r,16,16)),n=0,i=[],s=D(r,16),o=0;o<s;o++)n+=D(r,16,64+16*o)*t,t/=1e4;var a=Math.pow(10,D(r,16,48));return(e===0?1:-1)*Math.round(n*a)/a},Ri=function(r,e){var t=D(e,1),n=D(e,63,1),i=new Date((t===0?1:-1)*n/1e3+9466848e5);return r||i.setTime(i.getTime()+i.getTimezoneOffset()*6e4),i.usec=n%1e3,i.getMicroSeconds=function(){return this.usec},i.setMicroSeconds=function(s){this.usec=s},i.getUTCMicroSeconds=function(){return this.usec},i},nt=function(r){for(var e=D(r,32),t=D(r,32,32),n=D(r,32,64),i=96,s=[],o=0;o<e;o++)s[o]=D(r,32,i),i+=32,i+=32;var a=function(c){var h=D(r,32,i);if(i+=32,h==4294967295)return null;var l;if(c==23||c==20)return l=D(r,h*8,i),i+=h*8,l;if(c==25)return l=r.toString(this.encoding,i>>3,(i+=h<<3)>>3),l;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,h){var l=[],y;if(c.length>1){var m=c.shift();for(y=0;y<m;y++)l[y]=u(c,h);c.unshift(m)}else for(y=0;y<c[0];y++)l[y]=a(h);return l};return u(s,n)},Ya=function(r){return r.toString("utf8")},Ja=function(r){return r===null?null:D(r,8)>0},Za=function(r){r(20,Ka),r(21,Wa),r(23,Pi),r(26,Pi),r(1700,za),r(700,Ga),r(701,Va),r(16,Ja),r(1114,Ri.bind(null,!1)),r(1184,Ri.bind(null,!0)),r(1e3,nt),r(1007,nt),r(1016,nt),r(1008,nt),r(1009,nt),r(25,Ya)};Mi.exports={init:Za}});var Di=C((yl,Fi)=>{d();Fi.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var ot=C(st=>{d();var Xa=Li(),eu=Ni(),tu=fr(),ru=Di();st.getTypeParser=nu;st.setTypeParser=iu;st.arrayParser=tu;st.builtins=ru;var it={text:{},binary:{}};function qi(r){return String(r)}function nu(r,e){return e=e||"text",it[e]&&it[e][r]||qi}function iu(r,e,t){typeof e=="function"&&(t=e,e="text"),it[e][r]=t}Xa.init(function(r,e){it.text[r]=e});eu.init(function(r,e){it.binary[r]=e})});var at=C((Sl,xr)=>{"use strict";d();xr.exports={host:"localhost",user:w.platform==="win32"?w.env.USERNAME:w.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var qe=ot(),su=qe.getTypeParser(20,"text"),ou=qe.getTypeParser(1016,"text");xr.exports.__defineSetter__("parseInt8",function(r){qe.setTypeParser(20,"text",r?qe.getTypeParser(23,"text"):su),qe.setTypeParser(1016,"text",r?qe.getTypeParser(1007,"text"):ou)})});var Ct=C((El,Qi)=>{"use strict";d();var au=(hr(),K(cr)),uu=at();function cu(r){var e=r.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}function Oi(r){for(var e="{",t=0;t<r.length;t++)t>0&&(e=e+","),r[t]===null||typeof r[t]>"u"?e=e+"NULL":Array.isArray(r[t])?e=e+Oi(r[t]):r[t]instanceof p?e+="\\\\x"+r[t].toString("hex"):e+=cu(_t(r[t]));return e=e+"}",e}var _t=function(r,e){if(r==null)return null;if(r instanceof p)return r;if(ArrayBuffer.isView(r)){var t=p.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return r instanceof Date?uu.parseInputDatesAsUTC?fu(r):lu(r):Array.isArray(r)?Oi(r):typeof r=="object"?hu(r,e):r.toString()};function hu(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),_t(r.toPostgres(_t),e)}return JSON.stringify(r)}function te(r,e){for(r=""+r;r.length<e;)r="0"+r;return r}function lu(r){var e=-r.getTimezoneOffset(),t=r.getFullYear(),n=t<1;n&&(t=Math.abs(t)+1);var i=te(t,4)+"-"+te(r.getMonth()+1,2)+"-"+te(r.getDate(),2)+"T"+te(r.getHours(),2)+":"+te(r.getMinutes(),2)+":"+te(r.getSeconds(),2)+"."+te(r.getMilliseconds(),3);return e<0?(i+="-",e*=-1):i+="+",i+=te(Math.floor(e/60),2)+":"+te(e%60,2),n&&(i+=" BC"),i}function fu(r){var e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);var n=te(e,4)+"-"+te(r.getUTCMonth()+1,2)+"-"+te(r.getUTCDate(),2)+"T"+te(r.getUTCHours(),2)+":"+te(r.getUTCMinutes(),2)+":"+te(r.getUTCSeconds(),2)+"."+te(r.getUTCMilliseconds(),3);return n+="+00:00",t&&(n+=" BC"),n}function du(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var Er=function(r){return au.createHash("md5").update(r,"utf-8").digest("hex")},pu=function(r,e,t){var n=Er(e+r),i=Er(p.concat([p.from(n),t]));return"md5"+i};Qi.exports={prepareValue:function(e){return _t(e)},normalizeQueryConfig:du,postgresMd5PasswordHash:pu,md5:Er}});var Ki=C((vl,$i)=>{"use strict";d();var It=(hr(),K(cr));function yu(r){if(r.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=It.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}function wu(r,e,t){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Su(t);if(n.nonce.startsWith(r.clientNonce)){if(n.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var i=p.from(n.salt,"base64"),s=It.pbkdf2Sync(e,i,n.iteration,32,"sha256"),o=Ut(s,"Client Key"),a=bu(o),u="n=*,r="+r.clientNonce,c="r="+n.nonce+",s="+n.salt+",i="+n.iteration,h="c=biws,r="+n.nonce,l=u+","+c+","+h,y=Ut(a,l),m=Eu(o,y),S=m.toString("base64"),U=Ut(s,"Server Key"),I=Ut(U,l);r.message="SASLResponse",r.serverSignature=I.toString("base64"),r.response=h+",p="+S}function mu(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=xu(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function gu(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function Hi(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function ji(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],n=e.substring(2);return[t,n]}))}function Su(r){let e=ji(r),t=e.get("r");if(t){if(!gu(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!Hi(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let i=e.get("i");if(i){if(!/^[1-9][0-9]*$/.test(i))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let s=parseInt(i,10);return{nonce:t,salt:n,iteration:s}}function xu(r){let t=ji(r).get("v");if(t){if(!Hi(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function Eu(r,e){if(!p.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!p.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return p.from(r.map((t,n)=>r[n]^e[n]))}function bu(r){return It.createHash("sha256").update(r).digest()}function Ut(r,e){return It.createHmac("sha256",r).update(e).digest()}$i.exports={startSession:yu,continueSession:wu,finalizeSession:mu}});var br={};le(br,{join:()=>vu});function vu(...r){return r.join("/")}var vr=ee(()=>{d()});var Ar={};le(Ar,{stat:()=>Au});function Au(r,e){e(new Error("No filesystem"))}var _r=ee(()=>{d()});var Cr={};le(Cr,{default:()=>_u});var _u,Ur=ee(()=>{d();_u={}});var Wi={};le(Wi,{StringDecoder:()=>Ir});var Ir,Gi=ee(()=>{d();Ir=class{td;constructor(e){this.td=new TextDecoder(e)}write(e){return this.td.decode(e,{stream:!0})}end(e){return this.td.decode(e)}}});var Ji=C((Ll,Yi)=>{"use strict";d();var{Transform:Cu}=(Ur(),K(Cr)),{StringDecoder:Uu}=(Gi(),K(Wi)),_e=Symbol("last"),Lt=Symbol("decoder");function Iu(r,e,t){let n;if(this.overflow){if(n=this[Lt].write(r).split(this.matcher),n.length===1)return t();n.shift(),this.overflow=!1}else this[_e]+=this[Lt].write(r),n=this[_e].split(this.matcher);this[_e]=n.pop();for(let i=0;i<n.length;i++)try{zi(this,this.mapper(n[i]))}catch(s){return t(s)}if(this.overflow=this[_e].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function Lu(r){if(this[_e]+=this[Lt].end(),this[_e])try{zi(this,this.mapper(this[_e]))}catch(e){return r(e)}r()}function zi(r,e){e!==void 0&&r.push(e)}function Vi(r){return r}function Bu(r,e,t){switch(r=r||/\r?\n/,e=e||Vi,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=Vi)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=Iu,t.flush=Lu,t.readableObjectMode=!0;let n=new Cu(t);return n[_e]="",n[Lt]=new Uu("utf8"),n.matcher=r,n.mapper=e,n.maxLength=t.maxLength,n.skipOverflow=t.skipOverflow||!1,n.overflow=!1,n._destroy=function(i,s){this._writableState.errorEmitted=!1,s(i)},n}Yi.exports=Bu});var Bt={};le(Bt,{default:()=>Tu});var Tu,Tt=ee(()=>{d();Tu={}});var es=C((Pl,Ee)=>{"use strict";d();var Zi=(vr(),K(br)),Pu=(Ur(),K(Cr)).Stream,Ru=Ji(),Xi=(Tt(),K(Bt)),ku=5432,Pt=w.platform==="win32",ut=w.stderr,Mu=56,Nu=7,Fu=61440,Du=32768;function qu(r){return(r&Fu)==Du}var Oe=["host","port","database","user","password"],Lr=Oe.length,Ou=Oe[Lr-1];function Br(){var r=ut instanceof Pu&&ut.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);ut.write(Xi.format.apply(Xi,e))}}Object.defineProperty(Ee.exports,"isWin",{get:function(){return Pt},set:function(r){Pt=r}});Ee.exports.warnTo=function(r){var e=ut;return ut=r,e};Ee.exports.getFileName=function(r){var e=r||w.env,t=e.PGPASSFILE||(Pt?Zi.join(e.APPDATA||"./","postgresql","pgpass.conf"):Zi.join(e.HOME||"./",".pgpass"));return t};Ee.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(w.env,"PGPASSWORD")?!1:Pt?!0:(e=e||"<unkn>",qu(r.mode)?r.mode&(Mu|Nu)?(Br('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Br('WARNING: password file "%s" is not a plain file',e),!1))};var Qu=Ee.exports.match=function(r,e){return Oe.slice(0,-1).reduce(function(t,n,i){return i==1&&Number(r[n]||ku)===Number(e[n])?t&&!0:t&&(e[n]==="*"||e[n]===r[n])},!0)};Ee.exports.getPassword=function(r,e,t){var n,i=e.pipe(Ru());function s(u){var c=Hu(u);c&&ju(c)&&Qu(r,c)&&(n=c[Ou],i.end())}var o=function(){e.destroy(),t(n)},a=function(u){e.destroy(),Br("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",a),i.on("data",s).on("end",o).on("error",a)};var Hu=Ee.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",n=0,i=0,s=0,o={},a=!1,u=function(h,l,y){var m=r.substring(l,y);Object.hasOwnProperty.call(w.env,"PGPASS_NO_DEESCAPE")||(m=m.replace(/\\([:\\])/g,"$1")),o[Oe[h]]=m},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),a=n==Lr-1,a){u(n,i);break}c>=0&&e==":"&&t!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return o=Object.keys(o).length===Lr?o:null,o},ju=Ee.exports.isValidEntry=function(r){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},t=0;t<Oe.length;t+=1){var n=e[t],i=r[Oe[t]]||"",s=n(i);if(!s)return!1}return!0}});var rs=C((Ml,Tr)=>{"use strict";d();var kl=(vr(),K(br)),ts=(_r(),K(Ar)),Rt=es();Tr.exports=function(r,e){var t=Rt.getFileName();ts.stat(t,function(n,i){if(n||!Rt.usePgPass(i,t))return e(void 0);var s=ts.createReadStream(t);Rt.getPassword(r,s,e)})};Tr.exports.warnTo=Rt.warnTo});var Pr=C((Fl,ns)=>{"use strict";d();var $u=ot();function kt(r){this._types=r||$u,this.text={},this.binary={}}kt.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};kt.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};kt.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};ns.exports=kt});var is={};le(is,{default:()=>Ku});var Ku,ss=ee(()=>{d();Ku={}});var as=C((Ol,os)=>{"use strict";d();var Wu=(ar(),K(Xn)),Rr=(_r(),K(Ar));function kr(r){if(r.charAt(0)==="/"){var t=r.split(" ");return{host:t[0],database:t[1]}}var e=Wu.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)?encodeURI(r).replace(/\%25(\d\d)/g,"%$1"):r,!0),t=e.query;for(var n in t)Array.isArray(t[n])&&(t[n]=t[n][t[n].length-1]);var i=(e.auth||":").split(":");if(t.user=i[0],t.password=i.splice(1).join(":"),t.port=e.port,e.protocol=="socket:")return t.host=decodeURI(e.pathname),t.database=e.query.db,t.client_encoding=e.query.encoding,t;t.host||(t.host=e.hostname);var s=e.pathname;if(!t.host&&s&&/^%2f/i.test(s)){var o=s.split("/");t.host=decodeURIComponent(o[0]),s=o.splice(1).join("/")}switch(s&&s.charAt(0)==="/"&&(s=s.slice(1)||null),t.database=s&&decodeURI(s),(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={}),t.sslcert&&(t.ssl.cert=Rr.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=Rr.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=Rr.readFileSync(t.sslrootcert).toString()),t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}os.exports=kr;kr.parse=kr});var Nr=C((Hl,hs)=>{"use strict";d();var Gu=(ss(),K(is)),cs=at(),us=as().parse,se=function(r,e,t){return t===void 0?t=w.env["PG"+r.toUpperCase()]:t===!1||(t=w.env[t]),e[r]||t||cs[r]},Vu=function(){switch(w.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return cs.ssl},Qe=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},pe=function(r,e,t){var n=e[t];n!=null&&r.push(t+"="+Qe(n))},Mr=class{constructor(e){e=typeof e=="string"?us(e):e||{},e.connectionString&&(e=Object.assign({},e,us(e.connectionString))),this.user=se("user",e),this.database=se("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(se("port",e),10),this.host=se("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:se("password",e)}),this.binary=se("binary",e),this.options=se("options",e),this.ssl=typeof e.ssl>"u"?Vu():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=se("client_encoding",e),this.replication=se("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=se("application_name",e,"PGAPPNAME"),this.fallback_application_name=se("fallback_application_name",e,!1),this.statement_timeout=se("statement_timeout",e,!1),this.lock_timeout=se("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=se("idle_in_transaction_session_timeout",e,!1),this.query_timeout=se("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=w.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var t=[];pe(t,this,"user"),pe(t,this,"password"),pe(t,this,"port"),pe(t,this,"application_name"),pe(t,this,"fallback_application_name"),pe(t,this,"connect_timeout"),pe(t,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(pe(t,n,"sslmode"),pe(t,n,"sslca"),pe(t,n,"sslkey"),pe(t,n,"sslcert"),pe(t,n,"sslrootcert"),this.database&&t.push("dbname="+Qe(this.database)),this.replication&&t.push("replication="+Qe(this.replication)),this.host&&t.push("host="+Qe(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+Qe(this.client_encoding)),Gu.lookup(this.host,function(i,s){return i?e(i,null):(t.push("hostaddr="+Qe(s)),e(null,t.join(" ")))})}};hs.exports=Mr});var ds=C(($l,fs)=>{"use strict";d();var zu=ot(),ls=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Fr=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(e){var t;e.text?t=ls.exec(e.text):t=ls.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){for(var t=new Array(e.length),n=0,i=e.length;n<i;n++){var s=e[n];s!==null?t[n]=this._parsers[n](s):t[n]=null}return t}parseRow(e){for(var t={},n=0,i=e.length;n<i;n++){var s=e[n],o=this.fields[n].name;s!==null?t[o]=this._parsers[n](s):t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var t=0;t<e.length;t++){var n=e[t];this._types?this._parsers[t]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[t]=zu.getTypeParser(n.dataTypeID,n.format||"text")}}};fs.exports=Fr});var ms=C((Wl,ws)=>{"use strict";d();var{EventEmitter:Yu}=Ae(),ps=ds(),ys=Ct(),Dr=class extends Yu{constructor(e,t,n){super(),e=ys.normalizeQueryConfig(e,t,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,w.domain&&e.callback&&(this.callback=w.domain.bind(e.callback)),this._result=new ps(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new ps(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){w.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];return this.text&&t&&this.text!==t?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.isPreparedStatement=!0,this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:ys.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};ws.exports=Dr});function ne(...r){if(r.length===1&&r[0]instanceof Uint8Array)return r[0];let e=r.reduce((i,s)=>i+s.length,0),t=new Uint8Array(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return t}function lt(r,e){let t=r.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}function Zu(r,e,t,n=!0){let i=new Se(1024);i.writeUint8(22,0),i.writeUint16(769,0);let s=i.writeLengthUint16();i.writeUint8(1,0);let o=i.writeLengthUint24();i.writeUint16(771,0),g.getRandomValues(i.subarray(32));let a=i.writeLengthUint8(0);i.writeBytes(t),a();let u=i.writeLengthUint16(0);i.writeUint16(4865,0),u();let c=i.writeLengthUint8(0);i.writeUint8(0,0),c();let h=i.writeLengthUint16(0);if(n){i.writeUint16(0,0);let P=i.writeLengthUint16(0),J=i.writeLengthUint16(0);i.writeUint8(0,0);let $=i.writeLengthUint16(0);i.writeUTF8String(r),$(),J(),P()}i.writeUint16(11,0);let l=i.writeLengthUint16(0),y=i.writeLengthUint8(0);i.writeUint8(0,0),y(),l(),i.writeUint16(10,0);let m=i.writeLengthUint16(0),S=i.writeLengthUint16(0);i.writeUint16(23,0),S(),m(),i.writeUint16(13,0);let U=i.writeLengthUint16(0),I=i.writeLengthUint16(0);i.writeUint16(1027,0),i.writeUint16(2052,0),I(),U(),i.writeUint16(43,0);let M=i.writeLengthUint16(0),_=i.writeLengthUint8(0);i.writeUint16(772,0),_(),M(),i.writeUint16(51,0);let E=i.writeLengthUint16(0),j=i.writeLengthUint16(0);i.writeUint16(23,0);let z=i.writeLengthUint16(0);return i.writeBytes(new Uint8Array(e)),z(),j(),E(),h(),o(),s(),i}function Ce(r,e=""){return[...r].map(t=>t.toString(16).padStart(2,"0")).join(e)}function Xu(r,e){let t,n,[i]=r.expectLength(r.remaining());r.expectUint8(2,0);let[s]=r.expectLengthUint24(0);r.expectUint16(771,0);let o=r.readBytes(32);if(lt(o,[207,33,173,116,229,154,97,17,190,29,140,2,30,101,184,145,194,162,17,22,122,187,140,94,7,158,9,226,200,168,51,156]))throw new Error("Unexpected HelloRetryRequest");r.expectUint8(e.length,0),r.expectBytes(e,0),r.expectUint16(4865,0),r.expectUint8(0,0);let[a,u]=r.expectLengthUint16(0);for(;u()>0;){let c=r.readUint16(0),[h]=r.expectLengthUint16(0);if(c===43)r.expectUint16(772,0),n=!0;else if(c===51)r.expectUint16(23,0),r.expectUint16(65),t=r.readBytes(65);else throw new Error(`Unexpected extension 0x${Ce([c])}`);h()}if(a(),s(),i(),n!==!0)throw new Error("No TLS version provided");if(t===void 0)throw new Error("No key provided");return t}async function jr(r,e,t=ht){let n=await r(5);if(n===void 0)return;if(n.length<5)throw new Error("TLS record header truncated");let i=new Se(n),s=i.readUint8();if(s<20||s>24)throw new Error(`Illegal TLS record type 0x${s.toString(16)}`);if(e!==void 0&&s!==e)throw new Error(`Unexpected TLS record type 0x${s.toString(16).padStart(2,"0")} (expected 0x${e.toString(16).padStart(2,"0")})`);let o=i.readUint16(0);if([769,770,771].indexOf(o)<0)throw new Error(`Unsupported TLS record version 0x${o.toString(16).padStart(4,"0")}`);let a=i.readUint16(0);if(a>t)throw new Error(`Record too long: ${a} bytes`);let u=await r(a);if(u===void 0||u.length<a)throw new Error("TLS record content truncated");return{headerData:n,header:i,type:s,version:o,length:a,content:u}}async function $r(r,e,t){let n=await jr(r,23,ec);if(n===void 0)return;let i=new Se(n.content),[s]=i.expectLength(i.remaining());i.skip(n.length-16,0),i.skip(16,0),s();let o=await e.process(n.content,16,n.headerData),a=o.length-1;for(;o[a]===0;)a-=1;if(a<0)throw new Error("Decrypted message has no record type indicator (all zeroes)");let u=o[a],c=o.subarray(0,a);if(!(u===21&&c.length===2&&c[0]===1&&c[1]===0)){if(u===22&&c[0]===4)return $r(r,e,t);if(t!==void 0&&u!==t)throw new Error(`Unexpected TLS record type 0x${u.toString(16).padStart(2,"0")} (expected 0x${t.toString(16).padStart(2,"0")})`);return c}}async function tc(r,e,t){let n=ne(r,[t]),i=5,s=n.length+16,o=new Se(i+s);o.writeUint8(23,0),o.writeUint16(771,0),o.writeUint16(s,`${s} bytes follow`);let[a]=o.expectLength(s),u=o.array(),c=await e.process(n,16,u);return o.writeBytes(c.subarray(0,c.length-16)),o.writeBytes(c.subarray(c.length-16)),a(),o.array()}async function Ss(r,e,t){let n=Math.ceil(r.length/ht),i=[];for(let s=0;s<n;s++){let o=r.subarray(s*ht,(s+1)*ht),a=await tc(o,e,t);i.push(a)}return i}async function Kr(r,e,t){let n=await B.importKey("raw",r,{name:"HMAC",hash:{name:`SHA-${t}`}},!1,["sign"]);var i=new Uint8Array(await B.sign("HMAC",n,e));return i}async function rc(r,e,t,n){let i=n>>3,s=Math.ceil(t/i),o=new Uint8Array(s*i),a=await B.importKey("raw",r,{name:"HMAC",hash:{name:`SHA-${n}`}},!1,["sign"]),u=new Uint8Array(0);for(let c=0;c<s;c++){let h=ne(u,e,[c+1]),l=await B.sign("HMAC",a,h),y=new Uint8Array(l);o.set(y,i*c),u=y}return o.subarray(0,t)}async function ie(r,e,t,n,i){let s=vs.encode(e),o=ne([(n&65280)>>8,n&255],[xs.length+s.length],xs,s,[t.length],t);return rc(r,o,n,i)}async function nc(r,e,t,n,i){let s=n>>3,o=new Uint8Array(s),a=await B.importKey("raw",r,{name:"ECDH",namedCurve:"P-256"},!1,[]),u=await B.deriveBits({name:"ECDH",public:a},e,256),c=new Uint8Array(u),h=await B.digest("SHA-256",t),l=new Uint8Array(h),y=await Kr(new Uint8Array(1),o,n),m=await B.digest(`SHA-${n}`,new Uint8Array(0)),S=new Uint8Array(m),U=await ie(y,"derived",S,s,n),I=await Kr(U,c,n),M=await ie(I,"c hs traffic",l,s,n),_=await ie(I,"s hs traffic",l,s,n),E=await ie(M,"key",new Uint8Array(0),i,n),j=await ie(_,"key",new Uint8Array(0),i,n),z=await ie(M,"iv",new Uint8Array(0),12,n),P=await ie(_,"iv",new Uint8Array(0),12,n);return{serverHandshakeKey:j,serverHandshakeIV:P,clientHandshakeKey:E,clientHandshakeIV:z,handshakeSecret:I,clientSecret:M,serverSecret:_}}async function ic(r,e,t,n){let i=t>>3,s=new Uint8Array(i),o=await B.digest(`SHA-${t}`,new Uint8Array(0)),a=new Uint8Array(o),u=await ie(r,"derived",a,i,t),c=await Kr(u,s,t),h=await ie(c,"c ap traffic",e,i,t),l=await ie(c,"s ap traffic",e,i,t),y=await ie(h,"key",new Uint8Array(0),n,t),m=await ie(l,"key",new Uint8Array(0),n,t),S=await ie(h,"iv",new Uint8Array(0),12,t),U=await ie(l,"iv",new Uint8Array(0),12,t);return{serverApplicationKey:m,serverApplicationIV:U,clientApplicationKey:y,clientApplicationIV:S}}function Nt(r){return r>64&&r<91?r-65:r>96&&r<123?r-71:r>47&&r<58?r+4:r===43?62:r===47?63:r===61?64:void 0}function oc(r){let e=r.length,t=0,n=0,i=64,s=64,o=64,a=64,u=new Uint8Array(e*.75);for(;t<e;)i=Nt(r.charCodeAt(t++)),s=Nt(r.charCodeAt(t++)),o=Nt(r.charCodeAt(t++)),a=Nt(r.charCodeAt(t++)),u[n++]=i<<2|s>>4,u[n++]=(s&15)<<4|o>>2,u[n++]=(o&3)<<6|a;let c=s===64?0:o===64?2:a===64?1:0;return u.subarray(0,n-c)}function fc(r){let{length:e}=r;if(e>4)throw new Error(`Bit string length ${e} would overflow JS bit operators`);let t=0,n=0;for(let i=r.length-1;i>=0;i--)t|=r[i]<<n,n+=8;return t}function bs(r,e){let t={};r.expectUint8(re,0);let[n,i]=r.expectASN1Length(0);for(;i()>0;){r.expectUint8(ac,0);let[s]=r.expectASN1Length(0);r.expectUint8(re,0);let[o]=r.expectASN1Length(0);r.expectUint8(He,0);let a=r.readASN1OID(),u=lc[a]??a,c=r.readUint8();if(c!==uc&&c!==cc)throw new Error(`Unexpected item type in certificate ${e}: 0x${Ce([c])}`);let[h,l]=r.expectASN1Length(0),y=r.readUTF8String(l());if(h(),o(),s(),t[u]!==void 0)throw new Error(`Duplicate OID ${u} in certificate ${e}`);t[u]=y}return n(),t}function dc(r,e=0){let t=[],[n,i]=r.expectASN1Length(0);for(;i()>0;){let s=r.readUint8(0),[o,a]=r.expectASN1Length(0),u;s===(e|2)?u=r.readUTF8String(a()):u=r.readBytes(a()),t.push({name:u,type:s}),o()}return n(),t}function pc(r){let e={"1.2.840.113549.1.1.1":{name:"RSAES-PKCS1-v1_5"},"1.2.840.113549.1.1.5":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}},"1.2.840.113549.1.1.11":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},"1.2.840.113549.1.1.12":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},"1.2.840.113549.1.1.13":{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}},"1.2.840.113549.1.1.10":{name:"RSA-PSS"},"1.2.840.113549.1.1.7":{name:"RSA-OAEP"},"1.2.840.10045.2.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.1":{name:"ECDSA",hash:{name:"SHA-1"}},"1.2.840.10045.4.3.2":{name:"ECDSA",hash:{name:"SHA-256"}},"1.2.840.10045.4.3.3":{name:"ECDSA",hash:{name:"SHA-384"}},"1.2.840.10045.4.3.4":{name:"ECDSA",hash:{name:"SHA-512"}},"1.3.133.16.840.63.0.2":{name:"ECDH",kdf:"SHA-1"},"1.3.132.1.11.1":{name:"ECDH",kdf:"SHA-256"},"1.3.132.1.11.2":{name:"ECDH",kdf:"SHA-384"},"1.3.132.1.11.3":{name:"ECDH",kdf:"SHA-512"},"2.16.840.1.101.3.4.1.2":{name:"AES-CBC",length:128},"2.16.840.1.101.3.4.1.22":{name:"AES-CBC",length:192},"2.16.840.1.101.3.4.1.42":{name:"AES-CBC",length:256},"2.16.840.1.101.3.4.1.6":{name:"AES-GCM",length:128},"2.16.840.1.101.3.4.1.26":{name:"AES-GCM",length:192},"2.16.840.1.101.3.4.1.46":{name:"AES-GCM",length:256},"2.16.840.1.101.3.4.1.4":{name:"AES-CFB",length:128},"2.16.840.1.101.3.4.1.24":{name:"AES-CFB",length:192},"2.16.840.1.101.3.4.1.44":{name:"AES-CFB",length:256},"2.16.840.1.101.3.4.1.5":{name:"AES-KW",length:128},"2.16.840.1.101.3.4.1.25":{name:"AES-KW",length:192},"2.16.840.1.101.3.4.1.45":{name:"AES-KW",length:256},"1.2.840.113549.2.7":{name:"HMAC",hash:{name:"SHA-1"}},"1.2.840.113549.2.9":{name:"HMAC",hash:{name:"SHA-256"}},"1.2.840.113549.2.10":{name:"HMAC",hash:{name:"SHA-384"}},"1.2.840.113549.2.11":{name:"HMAC",hash:{name:"SHA-512"}},"1.2.840.113549.1.9.16.3.5":{name:"DH"},"1.3.14.3.2.26":{name:"SHA-1"},"2.16.840.1.101.3.4.2.1":{name:"SHA-256"},"2.16.840.1.101.3.4.2.2":{name:"SHA-384"},"2.16.840.1.101.3.4.2.3":{name:"SHA-512"},"1.2.840.113549.1.5.12":{name:"PBKDF2"},"1.2.840.10045.3.1.7":{name:"P-256"},"1.3.132.0.34":{name:"P-384"},"1.3.132.0.35":{name:"P-521"}}[r];if(e===void 0)throw new Error(`Unsupported algorithm identifier: ${r}`);return e}function As(r,e=[]){return Object.values(r).forEach(t=>{typeof t=="string"?e=[...e,t]:e=As(t,e)}),e}function yc(r){return As(r).join(" / ")}async function Cs(r,e,t,n,i){r.expectUint8(re,0);let[s]=r.expectASN1Length(0);r.expectUint8(Dt,0);let[o,a]=r.expectASN1Length(0),u=r.readBytes(a());o(),r.expectUint8(Dt,0);let[c,h]=r.expectASN1Length(0),l=r.readBytes(h());c(),s();let y=(I,M)=>I.length>M?I.subarray(I.length-M):I.length<M?ne(new Uint8Array(M-I.length),I):I,m=n==="P-256"?32:48,S=ne(y(u,m),y(l,m)),U=await B.importKey("spki",e,{name:"ECDSA",namedCurve:n},!1,["verify"]);if(await B.verify({name:"ECDSA",hash:i},U,S,t)!==!0)throw new Error("ECDSA-SECP256R1-SHA256 certificate verify failed")}async function mc(r,e,t){for(let s of e);let n=e[0];if(n.subjectAltNameMatchingHost(r)===void 0)throw new Error(`No matching subjectAltName for ${r}`);if(!n.isValidAtMoment())throw new Error("End-user certificate is not valid now");if(!n.extKeyUsage?.serverTls)throw new Error("End-user certificate has no TLS server extKeyUsage");let i=!1;for(let s of t);for(let s=0,o=e.length;s<o;s++){let a=e[s],u=a.authorityKeyIdentifier;if(u===void 0)throw new Error("Certificates without an authorityKeyIdentifier are not supported");let c=t.find(y=>y.subjectKeyIdentifier!==void 0&&lt(y.subjectKeyIdentifier,u));if(c===void 0&&(c=e[s+1]),c===void 0)throw new Error("Ran out of certificates before reaching trusted root");let h=c instanceof Wr;if(c.isValidAtMoment()!==!0)throw new Error("Signing certificate is not valid now");if(c.keyUsage?.usages.has("digitalSignature")!==!0)throw new Error("Signing certificate keyUsage does not include digital signatures");if(c.basicConstraints?.ca!==!0)throw new Error("Signing certificate basicConstraints do not indicate a CA certificate");let{pathLength:l}=c.basicConstraints;if(l!==void 0&&l<s)throw new Error("Exceeded certificate path length");if(a.algorithm==="1.2.840.10045.4.3.2"||a.algorithm==="1.2.840.10045.4.3.3"){let y=a.algorithm==="1.2.840.10045.4.3.2"?"SHA-256":"SHA-384",m=c.publicKey.identifiers,S=m.includes("1.2.840.10045.3.1.7")?"P-256":m.includes("1.3.132.0.34")?"P-384":void 0;if(S===void 0)throw new Error("Unsupported signing key curve");let U=new Ft(a.signature);await Cs(U,c.publicKey.all,a.signedData,S,y)}else if(a.algorithm==="1.2.840.113549.1.1.11"||a.algorithm==="1.2.840.113549.1.1.12"){let y=a.algorithm==="1.2.840.113549.1.1.11"?"SHA-256":"SHA-384",m=await B.importKey("spki",c.publicKey.all,{name:"RSASSA-PKCS1-v1_5",hash:y},!1,["verify"]);if(await B.verify({name:"RSASSA-PKCS1-v1_5"},m,a.signature,a.signedData)!==!0)throw new Error("RSASSA_PKCS1-v1_5-SHA256 certificate verify failed")}else throw new Error("Unsupported signing algorithm");if(h){i=!0;break}}return i}async function Sc(r,e,t,n,i){let s=new Ft(await e());s.expectUint8(8,0);let[o]=s.expectLengthUint24(),[a,u]=s.expectLengthUint16(0);for(;u()>0;){let T=s.readUint16(0);if(T===0)s.expectUint16(0,0);else if(T===10){let[F,ye]=s.expectLengthUint16("groups data");s.skip(ye(),0),F()}else throw new Error(`Unsupported server encrypted extension type 0x${Ce([T]).padStart(4,"0")}`)}a(),o(),s.remaining()===0&&s.extend(await e());let c=!1,h=s.readUint8();if(h===13){c=!0;let[T]=s.expectLengthUint24("certificate request data");s.expectUint8(0,0);let[F,ye]=s.expectLengthUint16("certificate request extensions");s.skip(ye(),0),F(),T(),s.remaining()===0&&s.extend(await e()),h=s.readUint8()}if(h!==11)throw new Error(`Unexpected handshake message type 0x${Ce([h])}`);let[l]=s.expectLengthUint24(0);s.expectUint8(0,0);let[y,m]=s.expectLengthUint24(0),S=[];for(;m()>0;){let[T]=s.expectLengthUint24(0),F=new _s(s);S.push(F),T();let[ye,Pe]=s.expectLengthUint16(),Un=s.subarray(Pe());ye()}if(y(),l(),S.length===0)throw new Error("No certificates supplied");let U=S[0],I=s.data.subarray(0,s.offset),M=ne(n,I),_=await B.digest("SHA-256",M),E=new Uint8Array(_),j=ne(gc.encode(" ".repeat(64)+"TLS 1.3, server CertificateVerify"),[0],E);s.remaining()===0&&s.extend(await e()),s.expectUint8(15,0);let[z]=s.expectLengthUint24(0),P=s.readUint16();if(P===1027){let[T]=s.expectLengthUint16();await Cs(s,U.publicKey.all,j,"P-256","SHA-256"),T()}else if(P===2052){let[T,F]=s.expectLengthUint16(),ye=s.subarray(F());T();let Pe=await B.importKey("spki",U.publicKey.all,{name:"RSA-PSS",hash:"SHA-256"},!1,["verify"]);if(await B.verify({name:"RSA-PSS",saltLength:32},Pe,ye,j)!==!0)throw new Error("RSA-PSS-RSAE-SHA256 certificate verify failed")}else throw new Error(`Unsupported certificate verify signature type 0x${Ce([P]).padStart(4,"0")}`);z();let J=s.data.subarray(0,s.offset),$=ne(n,J),he=await ie(t,"finished",new Uint8Array(0),32,256),L=await B.digest("SHA-256",$),R=await B.importKey("raw",he,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),N=await B.sign("HMAC",R,L),O=new Uint8Array(N);s.remaining()===0&&s.extend(await e()),s.expectUint8(20,0);let[Q,Z]=s.expectLengthUint24(0),X=s.readBytes(Z());if(Q(),s.remaining()!==0)throw new Error("Unexpected extra bytes in server handshake");if(lt(X,O)!==!0)throw new Error("Invalid server verify hash");if(!await mc(r,S,i))throw new Error("Validated certificate chain did not end in a trusted root");return[s.data,c]}async function Us(r,e,t,n,i=!0,s,o,a){let u=await B.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),c=await B.exportKey("raw",u.publicKey),h=new Uint8Array(32);g.getRandomValues(h);let l=Zu(r,c,h,i).array(),y=s?ne(s,l):l;if(n(y),o){let Y=await t(o.length);if(!Y||!lt(Y,o))throw new Error("Pre data did not match expectation")}let m=await jr(t,22);if(m===void 0)throw new Error("Connection closed while awaiting server hello");let S=new Se(m.content),U=Xu(S,h),I=await jr(t,20);if(I===void 0)throw new Error("Connection closed awaiting server cipher change");let M=new Se(I.content),[_]=M.expectLength(1);M.expectUint8(1,0),_();let E=l.subarray(5),j=m.content,z=ne(E,j),P=await nc(U,u.privateKey,z,256,16),J=await B.importKey("raw",P.serverHandshakeKey,{name:"AES-GCM"},!1,["decrypt"]),$=new Mt("decrypt",J,P.serverHandshakeIV),he=await B.importKey("raw",P.clientHandshakeKey,{name:"AES-GCM"},!1,["encrypt"]),L=new Mt("encrypt",he,P.clientHandshakeIV),R=async()=>{let Y=await $r(t,$,22);if(Y===void 0)throw new Error("Premature end of encrypted server handshake");return Y},[N,O]=await Sc(r,R,P.serverSecret,z,e),Q=new Se(6);Q.writeUint8(20,0),Q.writeUint16(771,0);let Z=Q.writeLengthUint16();Q.writeUint8(1,0),Z();let X=Q.array(),T=new Uint8Array(0);if(O){let Y=new Se(8);Y.writeUint8(11,0);let Ye=Y.writeLengthUint24("client certificate data");Y.writeUint8(0,0),Y.writeUint24(0,0),Ye(),T=Y.array()}let F=ne(z,N,T),ye=await B.digest("SHA-256",F),Pe=new Uint8Array(ye),Un=await ie(P.clientSecret,"finished",new Uint8Array(0),32,256),co=await B.importKey("raw",Un,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),ho=await B.sign("HMAC",co,Pe),lo=new Uint8Array(ho),pt=new Se(36);pt.writeUint8(20,0);let fo=pt.writeLengthUint24(0);pt.writeBytes(lo),fo();let po=pt.array(),In=await Ss(ne(T,po),L,22),Ln=Pe;if(T.length>0){let Y=F.subarray(0,F.length-T.length),Ye=await B.digest("SHA-256",Y);Ln=new Uint8Array(Ye)}let yt=await ic(P.handshakeSecret,Ln,256,16),yo=await B.importKey("raw",yt.clientApplicationKey,{name:"AES-GCM"},!0,["encrypt"]),wo=new Mt("encrypt",yo,yt.clientApplicationIV),mo=await B.importKey("raw",yt.serverApplicationKey,{name:"AES-GCM"},!0,["decrypt"]),go=new Mt("decrypt",mo,yt.serverApplicationIV),wt=!1;return[()=>{if(!wt){let Y=ne(X,...In);n(Y),wt=!0}return $r(t,go)},async Y=>{let Ye=wt;wt=!0;let Bn=await Ss(Y,wo,23),So=Ye?ne(...Bn):ne(X,...In,...Bn);n(So)}]}var Hr,gs,Ju,Se,Vl,ht,ec,B,vs,xs,sc,Mt,Ft,qr,Dt,re,ac,He,uc,cc,Es,Or,Te,Qr,hc,ct,lc,wc,_s,Wr,gc,xc,Is,Ls=ee(()=>{d();Hr="\xB7\xB7 ",gs=new TextEncoder,Ju=new TextDecoder,Se=class{offset;dataView;data;comments;indents;indent;constructor(r){this.offset=0,this.data=typeof r=="number"?new Uint8Array(r):r,this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength),this.comments={},this.indents={},this.indent=0}extend(r){let e=typeof r=="number"?new Uint8Array(r):r;this.data=ne(this.data,e),this.dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}remaining(){return this.data.length-this.offset}subarray(r){return this.data.subarray(this.offset,this.offset+=r)}skip(r,e){return this.offset+=r,e&&this.comment(e),this}comment(r,e=this.offset){throw new Error("No comments should be emitted outside of chatty mode")}readBytes(r){return this.data.slice(this.offset,this.offset+=r)}readUTF8String(r){let e=this.subarray(r);return Ju.decode(e)}readUTF8StringNullTerminated(){let r=this.offset;for(;this.data[r]!==0;)r++;let e=this.readUTF8String(r-this.offset);return this.expectUint8(0,"end of string"),e}readUint8(r){let e=this.dataView.getUint8(this.offset);return this.offset+=1,e}readUint16(r){let e=this.dataView.getUint16(this.offset);return this.offset+=2,e}readUint24(r){let e=this.readUint8(),t=this.readUint16();return(e<<16)+t}readUint32(r){let e=this.dataView.getUint32(this.offset);return this.offset+=4,e}expectBytes(r,e){let t=this.readBytes(r.length);if(!lt(t,r))throw new Error("Unexpected bytes")}expectUint8(r,e){let t=this.readUint8();if(t!==r)throw new Error(`Expected ${r}, got ${t}`)}expectUint16(r,e){let t=this.readUint16();if(t!==r)throw new Error(`Expected ${r}, got ${t}`)}expectUint24(r,e){let t=this.readUint24();if(t!==r)throw new Error(`Expected ${r}, got ${t}`)}expectUint32(r,e){let t=this.readUint32();if(t!==r)throw new Error(`Expected ${r}, got ${t}`)}expectLength(r,e=1){let t=this.offset,n=t+r;if(n>this.data.length)throw new Error("Expected length exceeds remaining data length");return this.indent+=e,this.indents[t]=this.indent,[()=>{if(this.indent-=e,this.indents[this.offset]=this.indent,this.offset!==n)throw new Error(`${r} bytes expected but ${this.offset-t} read`)},()=>n-this.offset]}expectLengthUint8(r){let e=this.readUint8();return this.expectLength(e)}expectLengthUint16(r){let e=this.readUint16();return this.expectLength(e)}expectLengthUint24(r){let e=this.readUint24();return this.expectLength(e)}expectLengthUint32(r){let e=this.readUint32();return this.expectLength(e)}expectLengthUint8Incl(r){let e=this.readUint8();return this.expectLength(e-1)}expectLengthUint16Incl(r){let e=this.readUint16();return this.expectLength(e-2)}expectLengthUint24Incl(r){let e=this.readUint24();return this.expectLength(e-3)}expectLengthUint32Incl(r){let e=this.readUint32();return this.expectLength(e-4)}writeBytes(r){return this.data.set(r,this.offset),this.offset+=r.length,this}writeUTF8String(r){let e=gs.encode(r);return this.writeBytes(e),this}writeUTF8StringNullTerminated(r){let e=gs.encode(r);return this.writeBytes(e),this.writeUint8(0),this}writeUint8(r,e){return this.dataView.setUint8(this.offset,r),this.offset+=1,this}writeUint16(r,e){return this.dataView.setUint16(this.offset,r),this.offset+=2,this}writeUint24(r,e){return this.writeUint8((r&16711680)>>16),this.writeUint16(r&65535,e),this}writeUint32(r,e){return this.dataView.setUint32(this.offset,r),this.offset+=4,this}_writeLengthGeneric(r,e,t){let n=this.offset;this.offset+=r;let i=this.offset;return this.indent+=1,this.indents[i]=this.indent,()=>{let s=this.offset-(e?n:i);if(r===1)this.dataView.setUint8(n,s);else if(r===2)this.dataView.setUint16(n,s);else if(r===3)this.dataView.setUint8(n,(s&16711680)>>16),this.dataView.setUint16(n+1,s&65535);else if(r===4)this.dataView.setUint32(n,s);else throw new Error(`Invalid length for length field: ${r}`);this.indent-=1,this.indents[this.offset]=this.indent}}writeLengthUint8(r){return this._writeLengthGeneric(1,!1,r)}writeLengthUint16(r){return this._writeLengthGeneric(2,!1,r)}writeLengthUint24(r){return this._writeLengthGeneric(3,!1,r)}writeLengthUint32(r){return this._writeLengthGeneric(4,!1,r)}writeLengthUint8Incl(r){return this._writeLengthGeneric(1,!0,r)}writeLengthUint16Incl(r){return this._writeLengthGeneric(2,!0,r)}writeLengthUint24Incl(r){return this._writeLengthGeneric(3,!0,r)}writeLengthUint32Incl(r){return this._writeLengthGeneric(4,!0,r)}array(){return this.data.subarray(0,this.offset)}commentedString(r=!1){let e=this.indents[0]!==void 0?Hr.repeat(this.indents[0]):"",t=this.indents[0]??0,n=r?this.data.length:this.offset;for(let i=0;i<n;i++){e+=this.data[i].toString(16).padStart(2,"0")+" ";let s=this.comments[i+1];this.indents[i+1]!==void 0&&(t=this.indents[i+1]),s&&(e+=` ${s}
${Hr.repeat(t)}`)}return e}};Vl=new RegExp(`  .+|^(${Hr})+`,"gm"),ht=1<<14,ec=ht+1+255;B=g.subtle,vs=new TextEncoder;xs=vs.encode("tls13 ");sc=2**31-1,Mt=class{constructor(r,e,t){this.mode=r,this.key=e,this.initialIv=t}recordsProcessed=0;priorPromise=Promise.resolve(new Uint8Array);async process(r,e,t){let n=this.processUnsequenced(r,e,t);return this.priorPromise=this.priorPromise.then(()=>n)}async processUnsequenced(r,e,t){let n=this.recordsProcessed;if(n===sc)throw new Error("Cannot encrypt/decrypt any more records");this.recordsProcessed+=1;let i=this.initialIv.slice(),s=i.length;i[s-1]^=n&255,i[s-2]^=n>>>8&255,i[s-3]^=n>>>16&255,i[s-4]^=n>>>24&255;let o=e<<3,a={name:"AES-GCM",iv:i,tagLength:o,additionalData:t},u=await B[this.mode](a,this.key,r);return new Uint8Array(u)}};Ft=class extends Se{readASN1Length(r){let e=this.readUint8();if(e<128)return e;let t=e&127,n=0;if(t===1)return this.readUint8(n);if(t===2)return this.readUint16(n);if(t===3)return this.readUint24(n);if(t===4)return this.readUint32(n);throw new Error(`ASN.1 length fields are only supported up to 4 bytes (this one is ${t} bytes)`)}expectASN1Length(r){let e=this.readASN1Length(r);return this.expectLength(e)}readASN1OID(){let[r,e]=this.expectASN1Length(0),t=this.readUint8(),n=`${Math.floor(t/40)}.${t%40}`;for(;e()>0;){let i=0;for(;;){let s=this.readUint8();if(i<<=7,i+=s&127,s<128)break}n+=`.${i}`}return r(),n}readASN1Boolean(){let[r,e]=this.expectASN1Length(0),t=e();if(t!==1)throw new Error(`Boolean has weird length: ${t}`);let n=this.readUint8(),i;if(n===255)i=!0;else if(n===0)i=!1;else throw new Error(`Boolean has weird value: 0x${Ce([n])}`);return r(),i}readASN1UTCTime(){let[r,e]=this.expectASN1Length(0),t=this.readUTF8String(e()).match(/^(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z$/);if(!t)throw new Error("Unrecognised ASN.1 UTC time format");let[,n,i,s,o,a,u]=t,c=parseInt(n,10),h=c+(c>=50?1900:2e3),l=new Date(`${h}-${i}-${s}T${o}:${a}:${u}Z`);return r(),l}readASN1BitString(){let[r,e]=this.expectASN1Length(0),t=this.readUint8(0),n=e(),i=this.readBytes(n);if(t>7)throw new Error(`Invalid right pad value: ${t}`);if(t>0){let s=8-t;for(let o=n-1;o>0;o--)i[o]=255&i[o-1]<<s|i[o]>>>t;i[0]=i[0]>>>t}return r(),i}},qr=1,Dt=2,re=48,ac=49,He=6,uc=19,cc=12,Es=23,Or=5,Te=4,Qr=3,hc=163,ct=128,lc={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN","2.5.4.7":"L","2.5.4.8":"ST","2.5.4.12":"T","2.5.4.42":"GN","2.5.4.43":"I","2.5.4.4":"SN","1.2.840.113549.1.9.1":"E-mail"};wc=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],_s=class{serialNumber;algorithm;issuer;validityPeriod;subject;publicKey;signature;keyUsage;subjectAltNames;extKeyUsage;authorityKeyIdentifier;subjectKeyIdentifier;basicConstraints;signedData;constructor(r){let e=r instanceof Ft?r:new Ft(r);e.expectUint8(re,0);let[t]=e.expectASN1Length(0),n=e.offset;e.expectUint8(re,0);let[i]=e.expectASN1Length(0);e.expectBytes([160,3,2,1,2],0),e.expectUint8(Dt,0);let[s,o]=e.expectASN1Length(0);this.serialNumber=e.subarray(o()),s(),e.expectUint8(re,0);let[a,u]=e.expectASN1Length(0);e.expectUint8(He,0),this.algorithm=e.readASN1OID(),u()>0&&(e.expectUint8(Or,0),e.expectUint8(0,0)),a(),this.issuer=bs(e,"issuer"),e.expectUint8(re,0);let[c]=e.expectASN1Length(0);e.expectUint8(Es,0);let h=e.readASN1UTCTime();e.expectUint8(Es,0);let l=e.readASN1UTCTime();this.validityPeriod={notBefore:h,notAfter:l},c(),this.subject=bs(e,"subject");let y=e.offset;e.expectUint8(re,0);let[m]=e.expectASN1Length(0);e.expectUint8(re,0);let[S,U]=e.expectASN1Length(0),I=[];for(;U()>0;){let $=e.readUint8();if($===He){let he=e.readASN1OID();I.push(he)}else $===Or&&e.expectUint8(0,0)}S(),e.expectUint8(Qr,0);let M=e.readASN1BitString();this.publicKey={identifiers:I,data:M,all:e.data.subarray(y,e.offset)},m(),e.expectUint8(hc,0);let[_]=e.expectASN1Length();e.expectUint8(re,0);let[E,j]=e.expectASN1Length(0);for(;j()>0;){e.expectUint8(re,0);let[$,he]=e.expectASN1Length();e.expectUint8(He,0);let L=e.readASN1OID();if(L==="2.5.29.17"){e.expectUint8(Te,0);let[R]=e.expectASN1Length(0);e.expectUint8(re,0);let N=dc(e,ct);this.subjectAltNames=N.filter(O=>O.type===(2|ct)).map(O=>O.name),R()}else if(L==="2.5.29.15"){e.expectUint8(qr,0);let R=e.readASN1Boolean();e.expectUint8(Te,0);let[N]=e.expectASN1Length(0);e.expectUint8(Qr,0);let O=e.readASN1BitString(),Q=fc(O),Z=new Set(wc.filter((X,T)=>Q&1<<T));N(),this.keyUsage={critical:R,usages:Z}}else if(L==="2.5.29.37"){this.extKeyUsage={},e.expectUint8(Te,0);let[R]=e.expectASN1Length(0);e.expectUint8(re,0);let[N,O]=e.expectASN1Length(0);for(;O()>0;){e.expectUint8(He,0);let Q=e.readASN1OID();Q==="1.3.6.1.5.5.7.3.1"&&(this.extKeyUsage.serverTls=!0),Q==="1.3.6.1.5.5.7.3.2"&&(this.extKeyUsage.clientTls=!0)}N(),R()}else if(L==="2.5.29.35"){e.expectUint8(Te,0);let[R]=e.expectASN1Length(0);e.expectUint8(re,0);let[N,O]=e.expectASN1Length(0);for(;O()>0;){let Q=e.readUint8();if(Q===(ct|0)){let[Z,X]=e.expectASN1Length(0);this.authorityKeyIdentifier=e.readBytes(X()),Z()}else if(Q===(ct|1)||Q===(ct|2)){let[Z,X]=e.expectASN1Length(0);e.skip(X(),0),Z()}else throw new Error("Unexpected data type in authorityKeyIdentifier certificate extension")}N(),R()}else if(L==="2.5.29.14"){e.expectUint8(Te,0);let[R]=e.expectASN1Length(0);e.expectUint8(Te,0);let[N,O]=e.expectASN1Length(0);this.subjectKeyIdentifier=e.readBytes(O()),N(),R()}else if(L==="2.5.29.19"){let R,N=e.readUint8();if(N===qr&&(R=e.readASN1Boolean(),N=e.readUint8()),N!==Te)throw new Error("Unexpected type in certificate basic constraints");let[O]=e.expectASN1Length(0);e.expectUint8(re,0);let[Q,Z]=e.expectASN1Length(),X;Z()>0&&(e.expectUint8(qr,0),X=e.readASN1Boolean());let T;if(Z()>0){e.expectUint8(Dt,0);let F=e.readASN1Length(0);if(T=F===1?e.readUint8():F===2?e.readUint16():F===3?e.readUint24():void 0,T===void 0)throw new Error("Too many bytes in max path length in certificate basicConstraints")}Q(),O(),this.basicConstraints={critical:R,ca:X,pathLength:T}}else e.skip(he(),0);$()}E(),_(),i(),this.signedData=e.data.subarray(n,e.offset),e.expectUint8(re,0);let[z,P]=e.expectASN1Length(0);e.expectUint8(He,0);let J=e.readASN1OID();if(P()>0&&(e.expectUint8(Or,0),e.expectUint8(0,0)),z(),J!==this.algorithm)throw new Error(`Certificate specifies different signature algorithms inside (${this.algorithm}) and out (${J})`);e.expectUint8(Qr,0),this.signature=e.readASN1BitString(),t()}static fromPEM(r){let e="[A-Z0-9 ]+",t=new RegExp(`-{5}BEGIN ${e}-{5}([a-zA-Z0-9=+\\/\\n\\r]+)-{5}END ${e}-{5}`,"g"),n=[],i=null;for(;i=t.exec(r);){let s=i[1].replace(/[\r\n]/g,""),o=oc(s),a=new this(o);n.push(a)}return n}subjectAltNameMatchingHost(r){let e=/[.][^.]+[.][^.]+$/;return(this.subjectAltNames??[]).find(t=>{let n=t,i=r;if(e.test(r)&&e.test(n)&&n.startsWith("*.")&&(n=n.slice(1),i=i.slice(i.indexOf("."))),n===i)return!0})}isValidAtMoment(r=new Date){return r>=this.validityPeriod.notBefore&&r<=this.validityPeriod.notAfter}description(){return"subject: "+Object.entries(this.subject).map(r=>r.join("=")).join(", ")+(this.subjectAltNames?`
subject alt names: `+this.subjectAltNames.join(", "):"")+(this.subjectKeyIdentifier?`
subject key id: ${Ce(this.subjectKeyIdentifier," ")}`:"")+`
issuer: `+Object.entries(this.issuer).map(r=>r.join("=")).join(", ")+(this.authorityKeyIdentifier?`
authority key id: ${Ce(this.authorityKeyIdentifier," ")}`:"")+`
validity: `+this.validityPeriod.notBefore.toISOString()+" \u2013 "+this.validityPeriod.notAfter.toISOString()+` (${this.isValidAtMoment()?"currently valid":"not valid"})`+(this.keyUsage?`
key usage (${this.keyUsage.critical?"critical":"non-critical"}): `+[...this.keyUsage.usages].join(", "):"")+(this.extKeyUsage?`
extended key usage: TLS server \u2014\xA0${this.extKeyUsage.serverTls}, TLS client \u2014\xA0${this.extKeyUsage.clientTls}`:"")+(this.basicConstraints?`
basic constraints (${this.basicConstraints.critical?"critical":"non-critical"}): CA \u2014\xA0${this.basicConstraints.ca}, path length \u2014 ${this.basicConstraints.pathLength}`:"")+`
signature algorithm: `+yc(pc(this.algorithm))}toJSON(){return{serialNumber:[...this.serialNumber],algorithm:this.algorithm,issuer:this.issuer,validityPeriod:{notBefore:this.validityPeriod.notBefore.toISOString(),notAfter:this.validityPeriod.notAfter.toISOString()},subject:this.subject,publicKey:{identifiers:this.publicKey.identifiers,data:[...this.publicKey.data],all:[...this.publicKey.all]},signature:[...this.signature],keyUsage:{critical:this.keyUsage?.critical,usages:[...this.keyUsage?.usages??[]]},subjectAltNames:this.subjectAltNames,extKeyUsage:this.extKeyUsage,authorityKeyIdentifier:this.authorityKeyIdentifier&&[...this.authorityKeyIdentifier],subjectKeyIdentifier:this.subjectKeyIdentifier&&[...this.subjectKeyIdentifier],basicConstraints:this.basicConstraints,signedData:[...this.signedData]}}},Wr=class extends _s{};gc=new TextEncoder;xc=class{addEventListener(...r){}},Is=class{constructor(r){this.socket=r,this.queue=[],r instanceof(globalThis.WebSocket??xc)?(this.socketIsWebSocket=!0,r.addEventListener("message",e=>this.enqueue(new Uint8Array(e.data))),r.addEventListener("close",()=>this.dequeue())):(this.socketIsWebSocket=!1,r.on("data",e=>this.enqueue(new Uint8Array(e))),r.on("close",()=>this.dequeue()))}queue;socketIsWebSocket;outstandingRequest;enqueue(r){this.queue.push(r),this.dequeue()}socketIsNotClosed(){let{socket:r}=this,{readyState:e}=r;return this.socketIsWebSocket?e<=1:e==="opening"||e==="open"}dequeue(){if(this.outstandingRequest===void 0)return;let{resolve:r,bytes:e}=this.outstandingRequest,t=this.bytesInQueue();if(t<e&&this.socketIsNotClosed())return;if(e=Math.min(e,t),e===0)return r(void 0);this.outstandingRequest=void 0;let n=this.queue[0],i=n.length;if(i===e)return this.queue.shift(),r(n);if(i>e)return this.queue[0]=n.subarray(e),r(n.subarray(0,e));{let s=new Uint8Array(e),o=e,a=0;for(;o>0;){let u=this.queue[0],c=u.length;c<=o?(this.queue.shift(),s.set(u,a),a+=c,o-=c):(this.queue[0]=u.subarray(o),s.set(u.subarray(0,o),a),o-=o,a+=o)}return r(s)}}bytesInQueue(){return this.queue.reduce((r,e)=>r+e.length,0)}async read(r){if(this.outstandingRequest!==void 0)throw new Error("Can\u2019t read while already awaiting read");return new Promise(e=>{this.outstandingRequest={resolve:e,bytes:r},this.dequeue()})}}});var Gr,Bs=ee(()=>{Gr=`-----BEGIN CERTIFICATE-----
MIIFazCCA1OgAwIBAgIRAIIQz7DSQONZRGPgu2OCiwAwDQYJKoZIhvcNAQELBQAw
TzELMAkGA1UEBhMCVVMxKTAnBgNVBAoTIEludGVybmV0IFNlY3VyaXR5IFJlc2Vh
cmNoIEdyb3VwMRUwEwYDVQQDEwxJU1JHIFJvb3QgWDEwHhcNMTUwNjA0MTEwNDM4
WhcNMzUwNjA0MTEwNDM4WjBPMQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJu
ZXQgU2VjdXJpdHkgUmVzZWFyY2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBY
MTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAK3oJHP0FDfzm54rVygc
h77ct984kIxuPOZXoHj3dcKi/vVqbvYATyjb3miGbESTtrFj/RQSa78f0uoxmyF+
0TM8ukj13Xnfs7j/EvEhmkvBioZxaUpmZmyPfjxwv60pIgbz5MDmgK7iS4+3mX6U
A5/TR5d8mUgjU+g4rk8Kb4Mu0UlXjIB0ttov0DiNewNwIRt18jA8+o+u3dpjq+sW
T8KOEUt+zwvo/7V3LvSye0rgTBIlDHCNAymg4VMk7BPZ7hm/ELNKjD+Jo2FR3qyH
B5T0Y3HsLuJvW5iB4YlcNHlsdu87kGJ55tukmi8mxdAQ4Q7e2RCOFvu396j3x+UC
B5iPNgiV5+I3lg02dZ77DnKxHZu8A/lJBdiB3QW0KtZB6awBdpUKD9jf1b0SHzUv
KBds0pjBqAlkd25HN7rOrFleaJ1/ctaJxQZBKT5ZPt0m9STJEadao0xAH0ahmbWn
OlFuhjuefXKnEgV4We0+UXgVCwOPjdAvBbI+e0ocS3MFEvzG6uBQE3xDk3SzynTn
jh8BCNAw1FtxNrQHusEwMFxIt4I7mKZ9YIqioymCzLq9gwQbooMDQaHWBfEbwrbw
qHyGO0aoSCqI3Haadr8faqU9GY/rOPNk3sgrDQoo//fb4hVC1CLQJ13hef4Y53CI
rU7m2Ys6xt0nUW7/vGT1M0NPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNV
HRMBAf8EBTADAQH/MB0GA1UdDgQWBBR5tFnme7bl5AFzgAiIyBpY9umbbjANBgkq
hkiG9w0BAQsFAAOCAgEAVR9YqbyyqFDQDLHYGmkgJykIrGF1XIpu+ILlaS/V9lZL
ubhzEFnTIZd+50xx+7LSYK05qAvqFyFWhfFQDlnrzuBZ6brJFe+GnY+EgPbk6ZGQ
3BebYhtF8GaV0nxvwuo77x/Py9auJ/GpsMiu/X1+mvoiBOv/2X/qkSsisRcOj/KK
NFtY2PwByVS5uCbMiogziUwthDyC3+6WVwW6LLv3xLfHTjuCvjHIInNzktHCgKQ5
ORAzI4JMPJ+GslWYHb4phowim57iaztXOoJwTdwJx4nLCgdNbOhdjsnvzqvHu7Ur
TkXWStAmzOVyyghqpZXjFaH3pO3JLF+l+/+sKAIuvtd7u+Nxe5AW0wdeRlN8NwdC
jNPElpzVmbUq4JUagEiuTDkHzsxHpFKVK7q4+63SM1N95R1NbdWhscdCb+ZAJzVc
oyi3B43njTOQ5yOf+1CceWxG1bQVs5ZufpsMljq4Ui0/1lvh+wjChP4kqKOJ2qxq
4RgqsahDYVvTH9w7jXbyLeiNdd8XM2w9U/t7y0Ff/9yi0GE44Za4rF2LN9d11TPA
mRGunUHBcnWEvgJBQl9nJEiU0Zsnvgc/ubhPgXRR4Xq37Z0j4r7g1SgEEzwxA57d
emyPxgcYxn/eR44/KJ4EBs+lVDR3veyJm+kXQ99b21/+jh5Xos1AnX5iItreGCc=
-----END CERTIFICATE-----
`});var Ps={};le(Ps,{Socket:()=>ue,isIP:()=>bc});function bc(r){return 0}var Ts,G,ue,Vr=ee(()=>{"use strict";d();Ts=zt(Ae(),1);Ls();Bs();G=class extends Ts.EventEmitter{_webSocketConstructor;get webSocketConstructor(){return this._webSocketConstructor??G.webSocketConstructor??G.defaults.webSocketConstructor}set webSocketConstructor(e){this._webSocketConstructor=e}_wsProxy;get wsProxy(){return this._wsProxy??G.wsProxy??G.defaults.wsProxy}set wsProxy(e){this._wsProxy=e}_coalesceWrites;get coalesceWrites(){return this._coalesceWrites??G.coalesceWrites??G.defaults.coalesceWrites}set coalesceWrites(e){this._coalesceWrites=e}_useSecureWebSocket;get useSecureWebSocket(){return this._useSecureWebSocket??G.useSecureWebSocket??G.defaults.useSecureWebSocket}set useSecureWebSocket(e){this._useSecureWebSocket=e}_disableSNI;get disableSNI(){return this._disableSNI??G.disableSNI??G.defaults.disableSNI}set disableSNI(e){this._disableSNI=e}_pipelineConnect;get pipelineConnect(){return this._pipelineConnect??G.pipelineConnect??G.defaults.pipelineConnect}set pipelineConnect(e){this._pipelineConnect=e}_pipelineTLS;get pipelineTLS(){return this._pipelineTLS??G.pipelineTLS??G.defaults.pipelineTLS}set pipelineTLS(e){this._pipelineTLS=e}_rootCerts;get rootCerts(){return this._rootCerts??G.rootCerts??G.defaults.rootCerts}set rootCerts(e){this._rootCerts=e}wsProxyAddrForHost(e,t){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please refer to https://github.com/neondatabase/serverless#run-your-own-websocket-proxy");return typeof n=="function"?n(e,t):`${n}?address=${e}:${t}`}connecting=!1;pending=!0;writable=!0;encrypted=!1;authorized=!1;destroyed=!1;ws=null;writeBuffer;tlsState=0;tlsRead;tlsWrite;setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}async connect(e,t,n){this.connecting=!0,n&&this.once("connect",n);let i;try{i=this.wsProxyAddrForHost(t,typeof e=="string"?parseInt(e,10):e)}catch(s){this.emit("error",s),this.emit("close");return}return this.ws=await new Promise(async s=>{try{let a=(this.useSecureWebSocket?"wss:":"ws:")+"//"+i,u;if(this.webSocketConstructor!==void 0)u=new this.webSocketConstructor(a);else try{u=new WebSocket(a)}catch{u=new __unstable_WebSocket(a)}u.addEventListener("open",()=>{s(u)})}catch(o){try{let u=(this.useSecureWebSocket?"https:":"http:")+"//"+i;await fetch(u,{headers:{Upgrade:"websocket"}}).then(c=>{let h=c.webSocket;if(h==null)throw o;h.accept(),s(h)})}catch{this.emit("error",new Error("All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless#run-on-node")),this.emit("close");return}}}),this.ws.binaryType="arraybuffer",this.ws.addEventListener("error",s=>{this.emit("error",s),this.emit("close")}),this.ws.addEventListener("close",()=>{this.emit("close")}),this.ws.addEventListener("message",s=>{if(this.tlsState===0){let o=p.from(s.data);this.emit("data",o)}}),this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready"),this}async startTls(e){this.tlsState=1;let t=Wr.fromPEM(Gr),n=new Is(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[o,a]=await Us(e,t,i,s,!this.disableSNI,void 0,this.pipelineTLS?new Uint8Array([83]):void 0);this.tlsRead=o,this.tlsWrite=a,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let t=p.from(e);this.emit("data",t)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let t=new Uint8Array(this.writeBuffer.length+e.length);t.set(this.writeBuffer),t.set(e,this.writeBuffer.length),this.writeBuffer=t}}write(e,t="utf8",n=i=>{}){return e.length===0?n():(typeof e=="string"&&(e=p.from(e,t)),this.tlsState===0?this.rawWrite(e):this.tlsState===1?this.once("secureConnection",()=>this.write(e,t,n)):this.tlsWrite(e),!0)}end(e=p.alloc(0),t="utf8",n){return this.write(e,t,()=>{this.ws.close(),n&&n()}),this}destroy(){return this.destroyed=!0,this.end()}},ue=G;we(ue,"defaults",{webSocketConstructor:void 0,wsProxy:e=>e+"/v2",useSecureWebSocket:!0,coalesceWrites:!0,disableSNI:!1,pipelineConnect:"password",pipelineTLS:!0,rootCerts:Gr}),we(ue,"webSocketConstructor"),we(ue,"wsProxy"),we(ue,"coalesceWrites"),we(ue,"useSecureWebSocket"),we(ue,"disableSNI"),we(ue,"pipelineConnect"),we(ue,"pipelineTLS"),we(ue,"rootCerts")});var hn=C(A=>{"use strict";d();Object.defineProperty(A,"__esModule",{value:!0});A.NoticeMessage=A.DataRowMessage=A.CommandCompleteMessage=A.ReadyForQueryMessage=A.NotificationResponseMessage=A.BackendKeyDataMessage=A.AuthenticationMD5Password=A.ParameterStatusMessage=A.ParameterDescriptionMessage=A.RowDescriptionMessage=A.Field=A.CopyResponse=A.CopyDataMessage=A.DatabaseError=A.copyDone=A.emptyQuery=A.replicationStart=A.portalSuspended=A.noData=A.closeComplete=A.bindComplete=A.parseComplete=void 0;A.parseComplete={name:"parseComplete",length:5};A.bindComplete={name:"bindComplete",length:5};A.closeComplete={name:"closeComplete",length:5};A.noData={name:"noData",length:5};A.portalSuspended={name:"portalSuspended",length:5};A.replicationStart={name:"replicationStart",length:4};A.emptyQuery={name:"emptyQuery",length:4};A.copyDone={name:"copyDone",length:4};var zr=class extends Error{constructor(e,t,n){super(e),this.length=t,this.name=n}};A.DatabaseError=zr;var Yr=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};A.CopyDataMessage=Yr;var Jr=class{constructor(e,t,n,i){this.length=e,this.name=t,this.binary=n,this.columnTypes=new Array(i)}};A.CopyResponse=Jr;var Zr=class{constructor(e,t,n,i,s,o,a){this.name=e,this.tableID=t,this.columnID=n,this.dataTypeID=i,this.dataTypeSize=s,this.dataTypeModifier=o,this.format=a}};A.Field=Zr;var Xr=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};A.RowDescriptionMessage=Xr;var en=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};A.ParameterDescriptionMessage=en;var tn=class{constructor(e,t,n){this.length=e,this.parameterName=t,this.parameterValue=n,this.name="parameterStatus"}};A.ParameterStatusMessage=tn;var rn=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};A.AuthenticationMD5Password=rn;var nn=class{constructor(e,t,n){this.length=e,this.processID=t,this.secretKey=n,this.name="backendKeyData"}};A.BackendKeyDataMessage=nn;var sn=class{constructor(e,t,n,i){this.length=e,this.processId=t,this.channel=n,this.payload=i,this.name="notification"}};A.NotificationResponseMessage=sn;var on=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};A.ReadyForQueryMessage=on;var an=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};A.CommandCompleteMessage=an;var un=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};A.DataRowMessage=un;var cn=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};A.NoticeMessage=cn});var Rs=C(qt=>{"use strict";d();Object.defineProperty(qt,"__esModule",{value:!0});qt.Writer=void 0;var ln=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=p.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var n=this.buffer,i=n.length+(n.length>>1)+e;this.buffer=p.allocUnsafe(i),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=p.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=p.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=p.allocUnsafe(this.size),t}};qt.Writer=ln});var Ms=C(Qt=>{"use strict";d();Object.defineProperty(Qt,"__esModule",{value:!0});Qt.serialize=void 0;var fn=Rs(),q=new fn.Writer,vc=r=>{q.addInt16(3).addInt16(0);for(let n of Object.keys(r))q.addCString(n).addCString(r[n]);q.addCString("client_encoding").addCString("UTF8");var e=q.addCString("").flush(),t=e.length+4;return new fn.Writer().addInt32(t).add(e).flush()},Ac=()=>{let r=p.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},_c=r=>q.addCString(r).flush(112),Cc=function(r,e){return q.addCString(r).addInt32(p.byteLength(e)).addString(e),q.flush(112)},Uc=function(r){return q.addString(r).flush(112)},Ic=r=>q.addCString(r).flush(81),ks=[],Lc=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||ks;for(var n=t.length,i=q.addCString(e).addCString(r.text).addInt16(n),s=0;s<n;s++)i.addInt32(t[s]);return q.flush(80)},je=new fn.Writer,Bc=function(r,e){for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];n==null?(q.addInt16(0),je.addInt32(-1)):n instanceof p?(q.addInt16(1),je.addInt32(n.length),je.add(n)):(q.addInt16(0),je.addInt32(p.byteLength(n)),je.addString(n))}},Tc=(r={})=>{let e=r.portal||"",t=r.statement||"",n=r.binary||!1,i=r.values||ks,s=i.length;return q.addCString(e).addCString(t),q.addInt16(s),Bc(i,r.valueMapper),q.addInt16(s),q.add(je.flush()),q.addInt16(n?1:0),q.flush(66)},Pc=p.from([69,0,0,0,9,0,0,0,0,0]),Rc=r=>{if(!r||!r.portal&&!r.rows)return Pc;let e=r.portal||"",t=r.rows||0,n=p.byteLength(e),i=4+n+1+4,s=p.allocUnsafe(1+i);return s[0]=69,s.writeInt32BE(i,1),s.write(e,5,"utf-8"),s[n+5]=0,s.writeUInt32BE(t,s.length-4),s},kc=(r,e)=>{let t=p.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},dn=(r,e)=>{let n=4+p.byteLength(e)+1,i=p.allocUnsafe(1+n);return i[0]=r,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[n]=0,i},Mc=q.addCString("P").flush(68),Nc=q.addCString("S").flush(68),Fc=r=>r.name?dn(68,`${r.type}${r.name||""}`):r.type==="P"?Mc:Nc,Dc=r=>{let e=`${r.type}${r.name||""}`;return dn(67,e)},qc=r=>q.add(r).flush(100),Oc=r=>dn(102,r),Ot=r=>p.from([r,0,0,0,4]),Qc=Ot(72),Hc=Ot(83),jc=Ot(88),$c=Ot(99),Kc={startup:vc,password:_c,requestSsl:Ac,sendSASLInitialResponseMessage:Cc,sendSCRAMClientFinalMessage:Uc,query:Ic,parse:Lc,bind:Tc,execute:Rc,describe:Fc,close:Dc,flush:()=>Qc,sync:()=>Hc,end:()=>jc,copyData:qc,copyDone:()=>$c,copyFail:Oc,cancel:kc};Qt.serialize=Kc});var Ns=C(Ht=>{"use strict";d();Object.defineProperty(Ht,"__esModule",{value:!0});Ht.BufferReader=void 0;var Wc=p.allocUnsafe(0),pn=class{constructor(e=0){this.offset=e,this.buffer=Wc,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};Ht.BufferReader=pn});var Fs={};le(Fs,{default:()=>Gc});var Gc,Ds=ee(()=>{d();Gc={}});var Qs=C($e=>{"use strict";d();var Vc=$e&&$e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($e,"__esModule",{value:!0});$e.Parser=void 0;var H=hn(),zc=Ns(),Yc=Vc((Ds(),K(Fs))),yn=1,Jc=4,qs=yn+Jc,Os=p.allocUnsafe(0),wn=class{constructor(e){if(this.buffer=Os,this.bufferLength=0,this.bufferOffset=0,this.reader=new zc.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+qs<=n;){let s=this.buffer[i],o=this.buffer.readUInt32BE(i+yn),a=yn+o;if(a+i<=n){let u=this.handlePacket(i+qs,s,o,this.buffer);t(u),i+=a}else break}i===n?(this.buffer=Os,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let s=this.buffer.byteLength*2;for(;t>=s;)s*=2;i=p.allocUnsafe(s)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,n,i){switch(t){case 50:return H.bindComplete;case 49:return H.parseComplete;case 51:return H.closeComplete;case 110:return H.noData;case 115:return H.portalSuspended;case 99:return H.copyDone;case 87:return H.replicationStart;case 73:return H.emptyQuery;case 68:return this.parseDataRowMessage(e,n,i);case 67:return this.parseCommandCompleteMessage(e,n,i);case 90:return this.parseReadyForQueryMessage(e,n,i);case 65:return this.parseNotificationMessage(e,n,i);case 82:return this.parseAuthenticationResponse(e,n,i);case 83:return this.parseParameterStatusMessage(e,n,i);case 75:return this.parseBackendKeyData(e,n,i);case 69:return this.parseErrorMessage(e,n,i,"error");case 78:return this.parseErrorMessage(e,n,i,"notice");case 84:return this.parseRowDescriptionMessage(e,n,i);case 116:return this.parseParameterDescriptionMessage(e,n,i);case 71:return this.parseCopyInMessage(e,n,i);case 72:return this.parseCopyOutMessage(e,n,i);case 100:return this.parseCopyData(e,n,i);default:Yc.default.fail(`unknown message code: ${t.toString(16)}`)}}parseReadyForQueryMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.string(1);return new H.ReadyForQueryMessage(t,i)}parseCommandCompleteMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.cstring();return new H.CommandCompleteMessage(t,i)}parseCopyData(e,t,n){let i=n.slice(e,e+(t-4));return new H.CopyDataMessage(t,i)}parseCopyInMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyInResponse")}parseCopyOutMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyOutResponse")}parseCopyMessage(e,t,n,i){this.reader.setBuffer(e,n);let s=this.reader.byte()!==0,o=this.reader.int16(),a=new H.CopyResponse(t,i,s,o);for(let u=0;u<o;u++)a.columnTypes[u]=this.reader.int16();return a}parseNotificationMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.cstring(),o=this.reader.cstring();return new H.NotificationResponseMessage(t,i,s,o)}parseRowDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new H.RowDescriptionMessage(t,i);for(let o=0;o<i;o++)s.fields[o]=this.parseField();return s}parseField(){let e=this.reader.cstring(),t=this.reader.int32(),n=this.reader.int16(),i=this.reader.int32(),s=this.reader.int16(),o=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new H.Field(e,t,n,i,s,o,a)}parseParameterDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new H.ParameterDescriptionMessage(t,i);for(let o=0;o<i;o++)s.dataTypeIDs[o]=this.reader.int32();return s}parseDataRowMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new Array(i);for(let o=0;o<i;o++){let a=this.reader.int32();s[o]=a===-1?null:this.reader.string(a)}return new H.DataRowMessage(t,s)}parseParameterStatusMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.cstring(),s=this.reader.cstring();return new H.ParameterStatusMessage(t,i,s)}parseBackendKeyData(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.int32();return new H.BackendKeyDataMessage(t,i,s)}parseAuthenticationResponse(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:s.length===8&&(s.name="authenticationCleartextPassword");break;case 5:if(s.length===12){s.name="authenticationMD5Password";let a=this.reader.bytes(4);return new H.AuthenticationMD5Password(t,a)}break;case 10:s.name="authenticationSASL",s.mechanisms=[];let o;do o=this.reader.cstring(),o&&s.mechanisms.push(o);while(o);break;case 11:s.name="authenticationSASLContinue",s.data=this.reader.string(t-8);break;case 12:s.name="authenticationSASLFinal",s.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return s}parseErrorMessage(e,t,n,i){this.reader.setBuffer(e,n);let s={},o=this.reader.string(1);for(;o!=="\0";)s[o]=this.reader.cstring(),o=this.reader.string(1);let a=s.M,u=i==="notice"?new H.NoticeMessage(t,a):new H.DatabaseError(a,t,i);return u.severity=s.S,u.code=s.C,u.detail=s.D,u.hint=s.H,u.position=s.P,u.internalPosition=s.p,u.internalQuery=s.q,u.where=s.W,u.schema=s.s,u.table=s.t,u.column=s.c,u.dataType=s.d,u.constraint=s.n,u.file=s.F,u.line=s.L,u.routine=s.R,u}};$e.Parser=wn});var mn=C(Ue=>{"use strict";d();Object.defineProperty(Ue,"__esModule",{value:!0});Ue.DatabaseError=Ue.serialize=Ue.parse=void 0;var Zc=hn();Object.defineProperty(Ue,"DatabaseError",{enumerable:!0,get:function(){return Zc.DatabaseError}});var Xc=Ms();Object.defineProperty(Ue,"serialize",{enumerable:!0,get:function(){return Xc.serialize}});var eh=Qs();function th(r,e){let t=new eh.Parser;return r.on("data",n=>t.parse(n,e)),new Promise(n=>r.on("end",()=>n()))}Ue.parse=th});var Hs={};le(Hs,{connect:()=>rh});function rh(r){let{socket:e,servername:t}=r;return e.startTls(t),e}var js=ee(()=>{d()});var Sn=C((Af,Ks)=>{"use strict";d();var $s=(Vr(),K(Ps)),nh=Ae().EventEmitter,{parse:ih,serialize:V}=mn(),sh=V.flush(),oh=V.sync(),ah=V.end(),gn=class extends nh{constructor(e){super(),e=e||{},this.stream=e.stream||new $s.Socket,typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var t=this;this.on("newListener",function(n){n==="message"&&(t._emitMessage=!0)})}connect(e,t){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let i=function(s){n._ending&&(s.code==="ECONNRESET"||s.code==="EPIPE")||n.emit("error",s)};if(this.stream.on("error",i),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(s){var o=s.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}var a=(js(),K(Hs));let u={socket:n.stream};n.ssl!==!0&&(Object.assign(u,n.ssl),"key"in n.ssl&&(u.key=n.ssl.key)),$s.isIP(t)===0&&(u.servername=t);try{n.stream=a.connect(u)}catch(c){return n.emit("error",c)}n.attachListeners(n.stream),n.stream.on("error",i),n.emit("sslconnect")})}attachListeners(e){ih(e,t=>{var n=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(n,t)})}requestSsl(){this.stream.write(V.requestSsl())}startup(e){this.stream.write(V.startup(e))}cancel(e,t){this._send(V.cancel(e,t))}password(e){this._send(V.password(e))}sendSASLInitialResponseMessage(e,t){this._send(V.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(V.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(V.query(e))}parse(e){this._send(V.parse(e))}bind(e){this._send(V.bind(e))}execute(e){this._send(V.execute(e))}flush(){this.stream.writable&&this.stream.write(sh)}sync(){this._ending=!0,this._send(oh)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(ah,()=>{this.stream.end()})}close(e){this._send(V.close(e))}describe(e){this._send(V.describe(e))}sendCopyFromChunk(e){this._send(V.copyData(e))}endCopyFrom(){this._send(V.copyDone())}sendCopyFail(e){this._send(V.copyFail(e))}};Ks.exports=gn});var Vs=C((Cf,Gs)=>{"use strict";d();var uh=Ae().EventEmitter,ch=Ct(),xn=Ki(),hh=rs(),lh=Pr(),fh=Nr(),Ws=ms(),dh=at(),ph=Sn(),jt=class extends uh{constructor(e){super(),this.connectionParameters=new fh(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var t=e||{};this._Promise=t.Promise||x.Promise,this._types=new lh(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=t.connection||new ph({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||dh.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=n=>{w.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){var t=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");w.nextTick(()=>{e(i)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){t.ssl?n.requestSsl():n.startup(t.getStartupConf())}),n.on("sslconnect",function(){n.startup(t.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),w.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,n)=>{this._connect(i=>{i?n(i):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{t.emit("error",n)}):this.password!==null?e():hh(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(()=>{let t=ch.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=xn.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}_handleAuthSASLContinue(e){try{xn.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{xn.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,t={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(t.application_name=n),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,n){return this._types.setTypeParser(e,t,n)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}escapeLiteral(e){for(var t=!1,n="'",i=0;i<e.length;i++){var s=e[i];s==="'"?n+=s+s:s==="\\"?(n+=s+s,t=!0):n+=s}return n+="'",t===!0&&(n=" E"+n),n}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&w.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,n){var i,s,o,a,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof t=="function"&&(i.callback=i.callback||t)):(o=this.connectionParameters.query_timeout,i=new Ws(e,t,n),i.callback||(s=new this._Promise((c,h)=>{i.callback=(l,y)=>l?h(l):c(y)}))),o&&(u=i.callback,a=setTimeout(()=>{var c=new Error("Query read timeout");w.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};var h=this.queryQueue.indexOf(i);h>-1&&this.queryQueue.splice(h,1),this._pulseQueryQueue()},o),i.callback=(c,h)=>{clearTimeout(a),u(c,h)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(w.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(w.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};jt.Query=Ws;Gs.exports=jt});var Zs=C((If,Js)=>{"use strict";d();var yh=Ae().EventEmitter,zs=function(){},Ys=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},En=class{constructor(e,t,n){this.client=e,this.idleListener=t,this.timeoutId=n}},Ke=class{constructor(e){this.callback=e}};function wh(){throw new Error("Release called on client which has already been released to the pool.")}function $t(r,e){if(e)return{callback:e,result:void 0};let t,n,i=function(o,a){o?t(o):n(a)},s=new r(function(o,a){n=o,t=a});return{callback:i,result:s}}function mh(r,e){return function t(n){n.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",n)}),r._remove(e),r.emit("error",n,e)}}var bn=class extends yh{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||Kt().Client,this.Promise=this.options.Promise||x.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let n=t.client;n.ref&&n.ref();let i=t.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let t=Ys(this._idle,n=>n.client===e);t!==void 0&&clearTimeout(t.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let t=$t(this.Promise,e),n=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&w.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Ke(t.callback)),n;let i=(a,u,c)=>{clearTimeout(o),t.callback(a,u,c)},s=new Ke(i),o=setTimeout(()=>{Ys(this._pendingQueue,a=>a.callback===i),s.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(s),n}return this.newClient(new Ke(t.callback)),n}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let n=mh(this,t);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(o=>{if(i&&clearTimeout(i),t.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(a=>a!==t),s&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,zs);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new Ke((c,h,l)=>l()),n,!1)},this.options.maxLifetimeSeconds*1e3);a.unref(),t.once("end",()=>clearTimeout(a))}return this._acquireClient(t,e,n,!0)}})}_acquireClient(e,t,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),t.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),t.callback(s,void 0,zs);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let n=!1;return i=>{n&&wh(),n=!0,this._release(e,t,i)}}_release(e,t,n){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let s;this.options.idleTimeoutMillis&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new En(e,t,s)),this._pulseQueue()}query(e,t,n){if(typeof e=="function"){let s=$t(this.Promise,e);return b(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof t=="function"&&(n=t,t=void 0);let i=$t(this.Promise,n);return n=i.callback,this.connect((s,o)=>{if(s)return n(s);let a=!1,u=c=>{a||(a=!0,o.release(c),n(c))};o.once("error",u),this.log("dispatching query");try{o.query(e,t,(c,h)=>{if(this.log("query dispatched"),o.removeListener("error",u),!a)return a=!0,o.release(c),c?n(c):n(void 0,h)})}catch(c){return o.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let t=$t(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};Js.exports=bn});var Xs={};le(Xs,{default:()=>gh});var gh,eo=ee(()=>{d();gh={}});var no=C((Tf,ro)=>{"use strict";d();var to=Ae().EventEmitter,Sh=(Tt(),K(Bt)),vn=Ct(),We=ro.exports=function(r,e,t){to.call(this),r=vn.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};Sh.inherits(We,to);var xh={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};We.prototype.handleError=function(r){var e=this.native.pq.resultErrorFields();if(e)for(var t in e){var n=xh[t]||t;r[n]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};We.prototype.then=function(r,e){return this._getPromise().then(r,e)};We.prototype.catch=function(r){return this._getPromise().catch(r)};We.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};We.prototype.submit=function(r){this.state="running";var e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;var t=function(s,o,a){if(r.native.arrayMode=!1,b(function(){e.emit("_done")}),s)return e.handleError(s);e._emitRowEvents&&(a.length>1?o.forEach((u,c)=>{u.forEach(h=>{e.emit("row",h,a[c])})}):o.forEach(function(u){e.emit("row",u,a)})),e.state="end",e.emit("end",a),e.callback&&e.callback(null,a)};if(w.domain&&(t=w.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(vn.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let s=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(s)}return r.native.execute(this.name,n,t)}return r.native.prepare(this.name,this.text,n.length,function(s){return s?t(s):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,n,t))})}else if(this.values){if(!Array.isArray(this.values)){let s=new Error("Query values must be an array");return t(s)}var i=this.values.map(vn.prepareValue);r.native.query(this.text,i,t)}else r.native.query(this.text,t)}});var ao=C((Rf,oo)=>{"use strict";d();var Eh=(eo(),K(Xs)),bh=Pr(),io=Ae().EventEmitter,vh=(Tt(),K(Bt)),Ah=Nr(),so=no(),ce=oo.exports=function(r){io.call(this),r=r||{},this._Promise=r.Promise||x.Promise,this._types=new bh(r.types),this.native=new Eh({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new Ah(r);this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ce.Query=so;vh.inherits(ce,io);ce.prototype._errorAllQueries=function(r){let e=t=>{w.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ce.prototype._connect=function(r){var e=this;if(this._connecting){w.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,n){if(t)return r(t);e.native.connect(n,function(i){if(i)return e.native.end(),r(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};ce.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(n=>{n?t(n):e()})})};ce.prototype.query=function(r,e,t){var n,i,s,o,a;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")s=r.query_timeout||this.connectionParameters.query_timeout,i=n=r,typeof e=="function"&&(r.callback=e);else if(s=this.connectionParameters.query_timeout,n=new so(r,e,t),!n.callback){let u,c;i=new this._Promise((h,l)=>{u=h,c=l}),n.callback=(h,l)=>h?c(h):u(l)}return s&&(a=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");w.nextTick(()=>{n.handleError(u,this.connection)}),a(u),n.callback=()=>{};var c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},s),n.callback=(u,c)=>{clearTimeout(o),a(u,c)}),this._queryable?this._ending?(n.native=this.native,w.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,w.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ce.prototype.end=function(r){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));var t;return r||(t=new this._Promise(function(n,i){r=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),w.nextTick(()=>{e.emit("end"),r&&r()})}),t};ce.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ce.prototype._pulseQueryQueue=function(r){if(!!this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);var t=this;e.once("_done",function(){t._pulseQueryQueue()})}};ce.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};ce.prototype.ref=function(){};ce.prototype.unref=function(){};ce.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};ce.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var An=C((Mf,uo)=>{"use strict";d();uo.exports=ao()});var Kt=C((Df,ft)=>{"use strict";d();var _h=Vs(),Ch=at(),Uh=Sn(),Ih=Zs(),{DatabaseError:Lh}=mn(),Bh=r=>class extends Ih{constructor(t){super(t,r)}},_n=function(r){this.defaults=Ch,this.Client=r,this.Query=this.Client.Query,this.Pool=Bh(this.Client),this._pools=[],this.Connection=Uh,this.types=ot(),this.DatabaseError=Lh};typeof w.env.NODE_PG_FORCE_NATIVE<"u"?ft.exports=new _n(An()):(ft.exports=new _n(_h),Object.defineProperty(ft.exports,"native",{configurable:!0,enumerable:!1,get(){var r=null;try{r=new _n(An())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ft.exports,"native",{value:r}),r}}))});d();d();d();ar();function xt(r){let e=or(r);return async function(t,...n){let i="";for(let l=0;l<t.length;l++){let y=t[l];if(y.indexOf("'")>=0)throw new Error("Single quotes are not allowed in query text");if(i+=y,l<n.length){let m=n[l],S=typeof m;if(S==="number"||S==="boolean")i+=String(m);else if(S==="string")i+=`'${m.replace(/'/g,"''")}'`;else throw new Error(`Invalid query parameter type '${S}' of object: ${m}`)}}let s=`https://${e.hostname}:4444/sql`,o=`dbname=${encodeURIComponent(e.pathname.substring(1))}`,a=`username=${encodeURIComponent(e.username)}`,u=`password=${encodeURIComponent(e.password)}`,c=`query=${encodeURIComponent(i)}`;return(await fetch(`${s}?${o}&${a}&${u}&${c}`,{method:"POST"})).json()}}var Wt=zt(Kt());Vr();var Ve=zt(Kt()),be=class extends Wt.Client{get neonConfig(){return this.connection.stream}connect(e){this.ssl&&this.neonConfig.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=true in the connection string) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. Please disable SSL on the Postgres connection."),this.host==="localhost"&&console.warn("The database host is 'localhost', which is the default host when none is set. If that's intentional, please ignore this warning. If not, perhaps an environment variable has not been set, or has not been passed to the library?");let t=super.connect(e),n=this.neonConfig.pipelineTLS&&this.ssl,i=this.neonConfig.pipelineConnect==="password";if(!n&&!this.neonConfig.pipelineConnect)return t;let s=this.connection;if(n&&s.on("connect",()=>s.stream.emit("data","S")),i){s.removeAllListeners("authenticationCleartextPassword"),s.removeAllListeners("readyForQuery"),s.once("readyForQuery",()=>s.on("readyForQuery",this._handleReadyForQuery.bind(this)));let o=this.ssl?"sslconnect":"connect";s.on(o,()=>{this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return t}async _handleAuthSASLContinue(e){let t=this.saslSession,n=this.password,i=e.data;if(t.message!=="SASLInitialResponse"||typeof n!="string"||typeof i!="string")throw new Error("SASL: protocol error");let s=Object.fromEntries(i.split(",").map(T=>{if(!/^.=/.test(T))throw new Error("SASL: Invalid attribute pair entry");let F=T[0],ye=T.substring(2);return[F,ye]})),o=s.r,a=s.s,u=s.i;if(!o||!/^[!-+--~]+$/.test(o))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!a||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(a))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!u||!/^[1-9][0-9]*$/.test(u))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!o.startsWith(t.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(o.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let c=parseInt(u,10),h=p.from(a,"base64"),l=new TextEncoder,y=l.encode(n),m=await g.subtle.importKey("raw",y,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),S=new Uint8Array(await g.subtle.sign("HMAC",m,p.concat([h,p.from([0,0,0,1])]))),U=S;for(var I=0;I<c-1;I++)S=new Uint8Array(await g.subtle.sign("HMAC",m,S)),U=p.from(U.map((T,F)=>U[F]^S[F]));let M=U,_=await g.subtle.importKey("raw",M,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),E=new Uint8Array(await g.subtle.sign("HMAC",_,l.encode("Client Key"))),j=await g.subtle.digest("SHA-256",E),z="n=*,r="+t.clientNonce,P="r="+o+",s="+a+",i="+c,J="c=biws,r="+o,$=z+","+P+","+J,he=await g.subtle.importKey("raw",j,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var L=new Uint8Array(await g.subtle.sign("HMAC",he,l.encode($))),R=p.from(E.map((T,F)=>E[F]^L[F])),N=R.toString("base64");let O=await g.subtle.importKey("raw",M,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),Q=await g.subtle.sign("HMAC",O,l.encode("Server Key")),Z=await g.subtle.importKey("raw",Q,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var X=p.from(await g.subtle.sign("HMAC",Z,l.encode($)));t.message="SASLResponse",t.serverSignature=X.toString("base64"),t.response=J+",p="+N,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}},Ge=class extends Wt.Pool{Client=be};d();async function Th(r){let e=Date.now(),t=await r();return[Date.now()-e,t]}async function dt(r,e,t=(n,i)=>{}){let n=[];for(let s=0;s<r;s++){let o=await Th(e),[a,u]=o;t(a,u),n.push(o)}return[n.reduce((s,[o])=>s+o,0),n]}async function Gt(r,e){let{sql:t,test:n}=e,{rows:i}=await r.query(t);if(!n(i))throw new Error(`Result fails test
Query: ${t}
Result: ${JSON.stringify(i)}`);return i}async function ze(r,e,t,n){await e.connect();let i=await dt(r,()=>Gt(e,n));return t.waitUntil(e.end()),i}async function Vt(r,e,t,n){let i=new Ge({connectionString:e}),s=await dt(r,()=>Gt(i,n));return t.waitUntil(i.end()),s}d();var Cn=[{sql:"SELECT * FROM employees LIMIT 10",test:r=>r.length>1&&typeof r[0].first_name=="string"},{sql:"SELECT now()",test:r=>/^2\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d.\d+Z$/.test(r[0].now.toISOString())}];async function td(r,e,t){let n=[];for(let i of Cn){let[,[[,s]]]=await Vt(1,e.NEON_DB_URL,t,i);n.push(s)}return new Response(JSON.stringify(n,null,2),{headers:{"Content-Type":"application/json"}})}var Ie={waitUntil(r){},passThroughOnException(){}};async function nd(r,e,t=n=>{}){let s=await xt(w.env.LOCAL_DB_URL)`SELECT * FROM "actor" WHERE "first_name" = ${"HELEN"}`;return t(s);for(let c of Cn){t(`
===== ${c.sql} =====

`);async function h(y,m){let S=String.fromCharCode(u+(u>25?23:65));t(`${S}
`);try{await fetch(`http://localhost:443/${S}`)}catch{}t('<span class="live">Live:</span>    ');let[,U]=await dt(a,()=>m(y),I=>t(`<span class="live">${I.toFixed()}ms</span> `));t(`
Sorted:  `),U.map(([I])=>I).sort((I,M)=>I-M).forEach((I,M)=>{t(M===(a-1)/2?`<span class="median">${I.toFixed()}ms</span> `:`${I.toFixed()}ms `)}),t(`

`),u+=1}async function l(y,m){t(`----- ${y} -----

`);for(let S of o)t(`${S} quer${S===1?"y":"ies"} \u2013 `),await h(S,m)}t(`Warm-up ...

`),await Vt(1,r.NEON_DB_URL,Ie,c),await l("Neon/wss, no pipelining",async y=>{let m=new be(r.NEON_DB_URL);m.neonConfig.pipelineConnect=!1,await ze(y,m,Ie,c)}),await l("Neon/wss, pipelined connect (default)",async y=>{let m=new be(r.NEON_DB_URL);await ze(y,m,Ie,c)}),await l("Neon/wss, pipelined connect, no coalescing",async y=>{let m=new be(r.NEON_DB_URL);m.neonConfig.coalesceWrites=!1,await ze(y,m,Ie,c)}),await l("Neon/wss, pipelined connect using Pool.query",async y=>{await Vt(y,r.NEON_DB_URL,Ie,c)}),await l("Neon/wss, pipelined connect using Pool.connect",async y=>{let m=new Ge({connectionString:r.NEON_DB_URL}),S=await m.connect();await dt(y,()=>Gt(S,c)),S.release(),Ie.waitUntil(m.end())}),await l("Patched pg/wss, pipelined connect",async y=>{let m=new be(r.MY_DB_URL);m.neonConfig.wsProxy=(S,U)=>`ws.manipulexity.com/v1?address=${S}:${U}`,m.neonConfig.pipelineConnect="password",await ze(y,m,Ie,c)}),e&&await l("Patched pg/subtls, pipelined TLS + connect",async y=>{let m=new be(r.MY_DB_URL+"?sslmode=verify-full");m.neonConfig.wsProxy=(S,U)=>`ws.manipulexity.com/v1?address=${S}:${U}`,m.neonConfig.useSecureWebSocket=!1,m.neonConfig.pipelineTLS=!0,m.neonConfig.pipelineConnect="password",await ze(y,m,Ie,c)})}}export{td as cf,nd as latencies,ue as neonConfig};
